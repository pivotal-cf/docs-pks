---
title: Installing and Configuring PKS
owner: PKS
---

<strong><%= modified_date %></strong>

<p class="note"><strong>Note</strong>: The PKS documentation is under development. This topic will continue to be updated and expanded to reflect the most current information.</p>

This topic describes how to install and configure Pivotal Container Service (PKS) on Google Cloud Platform (GCP) or vSphere without NSX-T integration.

Before performing the procedures in this topic, consult the requirements in the [Prerequisites and Resource Requirements](requirements.html) topic.

##<a id='install'></a> Step 1: Install PKS

Perform the following steps to install PKS:

1. Download the product file from [Pivotal Network](https://network.pivotal.io).
1. Navigate to `https://YOUR-OPS-MANAGER-FQDN/` in a browser to log in to the Ops Manager Installation Dashboard.
1. From the **Director Config** page, configure the following settings:
  * Select **Enable Post Deploy Scripts**.
  * Clear the **Disable BOSH DNS server for troubleshooting purposes** checkbox.
1. Click **Apply Changes**.
1. Click **Import a Product** to upload the product file.
1. Under **Pivotal Container Service** in the left column, click the plus sign to add this product to your staging area.

##<a id='configure'></a> Step 2: Configure PKS

Click the orange **Pivotal Container Service** tile to start the configuration process.

![Pivotal Container Service tile on the Ops Manager installation dashboard](images/pks-tile.png)

###<a id='azs-networks'></a> Assign AZs and Networks

Perform the following steps:

1. Click **Assign AZs and Networks**.

    ![Assign AZs and Networks pane in Ops Manager](images/azs-networks.png)

1. Select an availability zone for your singleton jobs, and one or more availability zones to balance other jobs in.
This is where PCF creates the PKS broker.
  <p class="note"><strong>Note</strong>: If you upgrade PKS, you must place singleton jobs in the AZ you selected when you first installed the PKS tile.
  You cannot move singleton jobs to another AZ.</p>
1. Under **Network**, select a subnet for the PKS broker.
1. Under **Service Network**, select a subnet for the on-demand service instances created by the PKS broker.
1. Click **Save**.

###<a id='pks-api'></a> PKS API

Perform the following steps:

1. Click **PKS API**.

    ![PKS API pane in Ops Manager](images/pks-api.png)

1. Under **Default Cluster Authorization Mode**, select an authentication mode.
Pivotal recommends selecting **RBAC**.
1. Under **Certificate**, provide your own certificate or have Ops Manager generate one.
To generate a new certificate and key, enter a wildcard domain you own.
For example, `*.pks.pcfvsphere.mydomain.com`.
1. Under **Generate RSA Certificate**, provide the domain names that you want your certificate to have.
The domain names should contain the hostname you intend to use for accessing the PKS API service.
1. Click **Save**.

###<a id='broker'></a> Broker

Perform the following steps:

1. Click **Broker**.

    ![Broker pane in Ops Manager](images/broker.png)

1. Under **Routing mode**, select a routing mode for the Kubernetes clusters deployed by PKS.
<p class="note"><strong>Note</strong>: In PKS v0.8, the only routing mode option is <code>external</code>.</p>
1. Under **AZ placement**, select an availability zone for the Kubernetes clusters deployed by PKS.
1. Click **Save**.

###<a id='plan'></a> Plan

Perform the following steps:

1. Click **Plan**.

    ![Plan pane in Ops Manager](images/plan.png)

1. Under **Plan description**, edit the description as needed. The plan description appears in the Services Marketplace, which developers can access by using either the Cloud Foundry Command Line Interface (cf CLI) or Apps Manager. 
1. Under **ETCD VM Type**, select the type of VM to use for the Kubernetes etcd nodes. 
	<p class="note"><strong>Note</strong>: This configuration is temporary until the master and etcd nodes are merged.</p>
1. Under **Master VM Type**, select the type of VM to use for Kubernetes master nodes.
1. Under **Worker VM Type**, select the type of VM to use for Kubernetes worker nodes.
1. Under **Worker Persistent Disk Type**, select the size of the persistent disk for the Kubernetes worker nodes.
1. Under **Worker Instances**, select the default number of Kubernetes worker nodes to provision for each cluster.
1. Click **Save**.

###<a id='iaas'></a> IaaS

Perform the following steps:

1. Click **IaaS**.
1. Under **Choose your IaaS**, select your IaaS.
1. Perform the steps specific to your IaaS.
	* For **vSphere**, ensure the values match those in the **vCenter Config** section of the **Ops Manager** tile:

        ![vSphere IaaS pane in Ops Manager](images/iaas-vsphere.png)
		1. Enter your **vCenter Host**, such as `vcenter.cf-example.com`.
		1. Enter your **Datacenter Name**, such as `cf-example-dc`.
		1. Enter your **Datastore Name**, such as `cf-example-ds`.
		1. Enter the **Stored VM Folder** so that the persistent stores know where to find the VMs. To retrieve the name of the folder, navigate to your Ops Manager Director tile, click **vCenter Config**, and locate the value for **VM Folder**. The default folder name is `pcf_vms`.
	* For **GCP**, ensure the values match those in the **Google Config** section of the **Ops Manager** tile:

        ![GCP IaaS pane in Ops Manager](images/iaas-gcp.png)
		1. For **GCP Project Id**, enter the name of the GCP project where you want to install PKS.
		1. For **GCP Network**, enter the name of the VPC network in your Ops Manager environment.
		1. Enter your **GCP Service Key**, which you created using [the instructions from the GCP prerequisites](requirements.html#gcp-prereqs).
1. Click **Save**.

###<a id='networking'></a> Networking

Perform the following steps:

1. Click **Networking**.
1. Under **Network**, select the Container Network Interface to use.
	* For **Flannel**, no additional fields are required.
	* For **NSX-T**, see [Installing and Configuring PKS with NSX-T Integration](installing-nsx-t.html).
1. Click **Save**.

###<a id='syslog '></a> (Optional) Syslog

To enable monitoring for PKS, this includes cluster logs, operators designate an external syslog endpoint for PKS component log messages. The endpoint serves as the input to a monitoring platform such as Datadog, Papertrail, or SumoLogic.

To specify the destination for PKS log messages, do the following:

1. Click **Syslog**
1. Select yes to configure syslog forwardings
1. Enter the syslog endpoint logs should be forwarded to
1. Enter the syslog port logs should be forwarded to
1. Select the transport protocol you want to use to forward the logs
1. If you chose to enable TLS to forward encrypted logs, you will have to provide a TLS certificate. 

###<a id='errands'></a> (Optional) Errands

1. Click **Errands**.

    ![Errands pane in Ops Manager](images/errands.png)

1. To modify the post-deploy errand settings for PKS, select the errand behavior under **Post-Deploy Errands**.
1. To modify the pre-delete errand settings for PKS, select the errand behavior under **Pre-Delete Errands**.
1. Click **Save**.

###<a id='resource-config'></a> (Optional) Resource Config

To modify the resource usage of PKS, click **Resource Config** and edit the **PKS on-demand broker** job.

###<a id='stemcell'></a> (Optional) Stemcell

To edit the stemcell configuration, click **Stemcell**. Click **Import Stemcell** to import a new stemcell. 

##<a id='apply-changes'></a> Step 3: Apply Changes

After configuring the tile, return to the Ops Manager Installation Dashboard and click **Apply Changes** to deploy the tile.

##<a id='retrieve-pks-api'></a> Step 4: Retrieve PKS API Endpoint

You must share the PKS API endpoint to allow your organization to use the API to create, update, and delete clusters.

When an operator creates a cluster, they provide an IP address for the Kubernetes master host, then point the load balancer to the newly created cluster.
If you use a load balancer as a service (LBaaS) tool, your LBaaS may manage cluster creation and configuration.

See [Using PKS](using.html#create-cluster) for more information.

Perform the following steps to retrieve the PKS API endpoint:

1. Navigate to the Ops Manager Installation Dashboard. 
1. Click the PKS tile.
1. Click the **Status** tab and locate the IP address of the PKS API endpoint. This is the endpoint that developers use to create and manage clusters.

##<a id='loadbalancer-pks-api'></a> Step 5: Configure External Load Balancer

Configure your external load balancer to resolve to the domain name used in the certificate you provided during the [PKS API](#pks-api) section of the tile configuration. Your external load balancer will forward traffic to the PKS API endpoint.

