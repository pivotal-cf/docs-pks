---
title: Release Notes
owner: TKGI
topictype: releasenotes
---



This topic contains release notes for <%= vars.product_short %> (<%= vars.k8s_runtime_abbr %>) v1.13.  

<p class="note warning"><strong>Warning:</strong> Before installing or upgrading to <%= vars.product_short %> v1.13,
review the <a href="#1-13-0-breaking-changes">Breaking Changes</a> below.
</p>


## <a id="1-13-7"></a><%= vars.k8s_runtime_abbr %> v1.13.7

**Release Date**: August 10, 2022


### <a id="1-13-7-snapshot"></a><a id="product-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Release</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/1141713">v1.13.7</a></td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>August 10, 2022</td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Antrea</td>
        <td>v1.3.1-1.2.3</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-Container-Networking-with-Antrea/1.3.1/rn/VMware-Container-Networking-with-Antrea-Version-131-123-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>cAdvisor</td>
        <td colspan=2>v0.39.1</td>
    </tr>
    <tr>
        <td>Containerd for Linux</td>
        <td colspan=2>v1.5.13&#42;</td>
    </tr>
    <tr>
        <td>CoreDNS</td>
        <td colspan=2>v1.8.4+vmware.10&#42;</td>
    </tr>
    <tr>
        <td>CSI Driver for vSphere</td>
        <td>v2.4.2</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-vSphere-Container-Storage-Plug-in/2.4/rn/vmware-vsphere-container-storage-plugin-24-release-notes/index.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Docker</td>
        <td colspan=2>Linux: v20.10.9<br>Windows: v20.10.9&#42;</td>
    </tr>
    <tr>
        <td>etcd</td>
        <td colspan=2>v3.5.4</td>
    </tr>
    <tr>
        <td>Harbor</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1128636">v2.5.3&#42;</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.5.3">Release Notes</a></td>
    </tr>
    </tr>
    <tr>
        <td>Kubernetes</td>
        <td>v1.22.12&#42;</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v12211">Release Notes</a></td>
    </tr>
    <tr>
        <td>Metrics Server</td>
        <td colspan=2>v0.5.0</td>
    </tr>
    <tr>
        <td>NCP</td>
        <td>v3.2.1.2&#42;</td>
        <td style="text-align: center;">
          <% if vars.product_version == "COMMENTED"  %>
          <a href="https://docs.vmware.com/en/VMware-NSX-Container-Plugin/3.2.1.1/rn/vmware-nsx-container-plugin-3211-release-notes/index.html">Release Notes</a>
          <% end %>
        </td>
    </tr>
    <tr>
        <td>Percona XtraDB Cluster (PXC)</td>
        <td colspan=2>v0.44.0&#42;</td>
    </tr>
    <tr>
        <td>UAA</td>
        <td colspan=2>v74.5.46&#42;</td>
    </tr>
    <tr>
        <td>Velero</td>
        <td><a href="https://customerconnect.vmware.com/downloads/get-download?downloadGroup=VELERO-163">v1.6.3</a></td>
        <td style="text-align: center;"><a href="https://github.com/vmware-tanzu/velero/releases/tag/v1.6.3">Release Notes</a></td>
    </tr>
    <tr>
        <td>Wavefront</td>
        <td colspan=2>Wavefront Collector: v1.7.1<br>Wavefront Proxy: v10.13</td>
    </tr>
    <tr>
        <th>Compatibilities</th>
        <th colspan=2>Versions</th>
    </tr>
    <tr>
        <td>Ops Manager</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/1141713"><%= vars.product_network %></a>.</td>
    </tr>
    <tr>
        <td>NSX-T</td>
        <td rowspan=2 colspan=2>See <a href="https://interopmatrix.vmware.com/Interoperability?col=644&row=0,">VMware Product Interoperability Matrices</a>.</td></td>
        <%# All versions link: https://interopmatrix.vmware.com/Interoperability?col=644&row=0, #%>
    </tr>
    <tr>
        <td>vSphere</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.51 or later</td>
    </tr>
    <tr>
        <td>Xenial stemcells</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/1141713"><%= vars.product_network %></a>.</td>
    </tr>
</table>

<a id="1-13-7-component-updates"></a>&#42; Components marked with an asterisk have been updated.  
&#42;&#42; To use Policy API features, you must use NSX-T v3.1.3.  


### <a id="1-13-7-upgrade"></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> v1.13.7 are from 
<%= vars.k8s_runtime_abbr %> v1.13.6 and earlier <%= vars.k8s_runtime_abbr %> v1.13 patches, and from
<%= vars.k8s_runtime_abbr %> v1.12.6 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  

### <a id="1-13-7-features"></a><a id="1-13-7-enhancements"></a>Features and Enhancements

* Supports configuring Telegraf to export output using the `metric_version=1` format instead of the default `metric_version=2` format. 
For more information on Telegraf output formats, 
see [Example Output](https://github.com/influxdata/telegraf/blob/v1.20.3/plugins/inputs/prometheus/README.md#example-output) 
in the Telegraf GitHub documentation.  


### <a id="1-13-7-bug-fixes"></a>Resolved Issues

<%= vars.k8s_runtime_abbr %> v1.13.7 has the following resolved issues:  

* **[Security Fix]** Fixes the following CVEs:  
    * Open SSL vulnerability [CVE-2022-1292](https://nvd.nist.gov/vuln/detail/CVE-2022-1292).  
    * Open SSL vulnerability [CVE-2022-1343](https://nvd.nist.gov/vuln/detail/CVE-2022-1343).  
    * Open SSL vulnerability [CVE-2022-1434](https://nvd.nist.gov/vuln/detail/CVE-2022-1434).  
    * Open SSL vulnerability [CVE-2022-1473](https://nvd.nist.gov/vuln/detail/CVE-2022-1473).  
    * Open SSL vulnerability [CVE-2022-2068](https://nvd.nist.gov/vuln/detail/CVE-2022-2068).
    * Open SSL vulnerability [CVE-2022-2097](https://nvd.nist.gov/vuln/detail/CVE-2022-2097).
    
* Fixes [Kubernetes Services Cannot be Accessed from a Windows Pod in some Windows Clusters](#1-13-6-windows-cluster-ncp-issue).  
* Fixes [Telegraf Output Is Exported Using the Wrong Format](#1-13-0-telegraf-format-2).  

<% if vars.product_version == "COMMENTED"  %>
<%#
* Fixes [](#1-13-0-).      
* Fixes the following CVEs:  
  *  [CVE-2021-](https://nvd.nist.gov/vuln/detail/CVE-2021-).  
* Component bumps fix the following CVEs:  
    *  [CVE-2021-](https://nvd.nist.gov/vuln/detail/CVE-2021-): .  
    #%>
<% end %>


### <a id="1-13-7-deprecations"></a><a id="1-13-7-upcoming-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Upcoming Deprecations](#1-13-0-upcoming-deprecations) in the
<%= vars.k8s_runtime_abbr %> v1.13.0 Release Notes below.

###<a id="1-13-7-known-issues"></a>Known Issues

Except where noted, the known issues in <%= vars.product_short %> v1.13.6
are also in <%= vars.product_short %> v1.13.7.
See the <%= vars.k8s_runtime_abbr %> v1.13.6 [Known Issues](#1-13-6-known-issues) below.

For Known Issues in NCP v3.2.1.1, see
[NSX Container Plugin 3.2.1.1 Release Notes](https://docs.vmware.com/en/VMware-NSX-Container-Plugin/3.2.1.1/rn/vmware-nsx-container-plugin-3211-release-notes/index.html).

<hr>


## <a id="management-console-1-13-7"></a> <%= vars.k8s_runtime_abbr %> Management Console v1.13.7

**Release Date**: August 10, 2022

<p class="note"><strong>Note</strong>: <%= vars.product_short %> Management Console provides an opinionated
    installation of <%= vars.k8s_runtime_abbr %>. The supported versions may differ from or be more limited than
    what is generally supported by <%= vars.k8s_runtime_abbr %>.
</p>

### <a id="management-console-1-13-7-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Element</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://customerconnect.vmware.com/downloads/details?downloadGroup=TKGIMC-1130&productId=1231&rPId=79290">v1.13.7</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>August 10, 2022</td>
    </tr>
    <tr>
        <td>Installed <%= vars.k8s_runtime_abbr %> version</td>
        <td colspan=2><a href="#1-13-7">v1.13.7</a></td>
    </tr>
    <tr>
        <td>Installed Ops Manager version</td>
        <td>v2.10.45</td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/ops-manager/2-10/release-notes.html#2-10-45">Release Notes</a></td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Installed Kubernetes version</td>
        <td>v1.22.12&#42;</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v12211">Release Notes</a></td>
    </tr>
    <tr>
        <td>Installed Harbor Registry version</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1128636">v2.5.3&#42;</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.5.3">Release Notes</a></td>
    </tr>
    <tr>
        <td>Linux stemcell</td>
        <td colspan=2>v621.256&#42;</td>
    </tr>

</table>

<a id="management-console-1-13-7-component-updates"></a>&#42; Components marked with an asterisk have been updated.

### <a id="management-console-1-13-7-upgrade"></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> Management Console v1.13.7 are from
<%= vars.k8s_runtime_abbr %> MC v1.13.6 and earlier <%= vars.k8s_runtime_abbr %> v1.13 patches, and from
<%= vars.k8s_runtime_abbr %> MC v1.12.6 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  

### <a id="management-console-1-13-7-features"></a>Features and Resolved Issues

<%= vars.k8s_runtime_abbr %> Management Console v1.13.7 has the following features and enhancements:  

<% if vars.product_version == "COMMENTED"  %>
<%#
This release of the <  %= vars.product_short %  > Management Console includes no new features or resolved issues.      
This release of the TKGI Management Console includes no new features or resolved issues.
< %= vars.k8s_runtime_abbr % > Management Console v1.13.7 has the following features and enhancements:
< %= vars.k8s_runtime_abbr % > Management Console v1.13.7 has the following resolved issues:  
* Fixes [](#management-console-1-13-0-).  
 #%>
<% end %>

 
### <a id="management-console-1-13-7-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Deprecations](#management-console-1-13-0-deprecations) in the
<%= vars.k8s_runtime_abbr %> MC v1.13.0 Release Notes below.

### <a id="management-console-1-13-7-known-issues"></a> Known Issues

Except where noted, the known issues in <%= vars.product_short %> Management Console v1.13.6
are also in <%= vars.product_short %> Management Console v1.13.7.
See the <%= vars.k8s_runtime_abbr %> MC v1.13.6 [Known Issues](#management-console-1-13-6-known-issues) below.

<hr>


## <a id="1-13-6"></a><%= vars.k8s_runtime_abbr %> v1.13.6

**Release Date**: June 29, 2022


### <a id="1-13-6-snapshot"></a><a id="product-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Release</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://network.pivotal.io/products/pivotal-container-service/releases/1119577/">v1.13.6</a></td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>June 29, 2022</td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Antrea</td>
        <td>v1.3.1-1.2.3</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-Container-Networking-with-Antrea/1.3.1/rn/VMware-Container-Networking-with-Antrea-Version-131-123-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>cAdvisor</td>
        <td colspan=2>v0.39.1</td>
    </tr>
    <tr>
        <td>Containerd for Linux</td>
        <td colspan=2>v1.5.9</td>
    </tr>
    <tr>
        <td>CoreDNS</td>
        <td colspan=2>v1.8.4+vmware.7</td>
    </tr>
    <tr>
        <td>CSI Driver for vSphere</td>
        <td>v2.4.2&#42;</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-vSphere-Container-Storage-Plug-in/2.4/rn/vmware-vsphere-container-storage-plugin-24-release-notes/index.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Docker</td>
        <td colspan=2>Linux: v20.10.9<br>Windows: v20.10.7</td>
    </tr>
    <tr>
        <td>etcd</td>
        <td colspan=2>v3.5.4</td>
    </tr>
    <tr>
        <td>Harbor</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1109857">v2.5.1</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.5.1">Release Notes</a></td>
    </tr>
    </tr>
    <tr>
        <td>Kubernetes</td>
        <td>v1.22.6</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1225">Release Notes</a></td>
    </tr>
    <tr>
        <td>Metrics Server</td>
        <td colspan=2>v0.5.0</td>
    </tr>
    <tr>
        <td>NCP</td>
        <td>v3.2.1.1</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-NSX-Container-Plugin/3.2.1.1/rn/vmware-nsx-container-plugin-3211-release-notes/index.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Percona XtraDB Cluster (PXC)</td>
        <td colspan=2>v0.42.0</td>
    </tr>
    <tr>
        <td>UAA</td>
        <td colspan=2>v74.5.44&#42;</td>
    </tr>
    <tr>
        <td>Velero</td>
        <td><a href="https://customerconnect.vmware.com/downloads/get-download?downloadGroup=VELERO-163">v1.6.3</a></td>
        <td style="text-align: center;"><a href="https://github.com/vmware-tanzu/velero/releases/tag/v1.6.3">Release Notes</a></td>
    </tr>
    <tr>
        <td>Wavefront</td>
        <td colspan=2>Wavefront Collector: v1.7.1<br>Wavefront Proxy: v10.13</td>
    </tr>
    <tr>
        <th>Compatibilities</th>
        <th colspan=2>Versions</th>
    </tr>
    <tr>
        <td>Ops Manager</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service/releases/1119577/"><%= vars.product_network %></a>.</td>
    </tr>
    <tr>
        <td>NSX-T</td>
        <td rowspan=2 colspan=2>See <a href="https://interopmatrix.vmware.com/Interoperability?col=644&row=0,">VMware Product Interoperability Matrices</a>.</td></td>
        <%# All versions link: https://interopmatrix.vmware.com/Interoperability?col=644&row=0, #%>
    </tr>
    <tr>
        <td>vSphere</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.46 or later</td>
    </tr>
    <tr>
        <td>Xenial stemcells</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service/releases/1119577/"><%= vars.product_network %></a>.</td>
    </tr>
</table>

<a id="1-13-6-component-updates"></a>&#42; Components marked with an asterisk have been updated.  
&#42;&#42; To use Policy API features, you must use NSX-T v3.1.3.  


### <a id="1-13-6-upgrade"></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> v1.13.6 are from 
<%= vars.k8s_runtime_abbr %> v1.13.5 and earlier <%= vars.k8s_runtime_abbr %> v1.13 patches, and from
<%= vars.k8s_runtime_abbr %> v1.12.6 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  

### <a id="1-13-6-features"></a><a id="1-13-6-enhancements"></a>Features and Enhancements

<%= vars.k8s_runtime_abbr %> v1.13.6 has the following features:

* Supports accessing images in a private Docker registry from Linux clusters with containerd container runtimes. 
For more information, see [Configuring Cluster Access to Private Docker Registries (Beta)](docker-custom-ca-certs.html).  

* Supports VMware NSX-T v3.2.1.


### <a id="1-13-6-bug-fixes"></a>Resolved Issues

<%= vars.k8s_runtime_abbr %> v1.13.6 has the following resolved issues:  

* **[Security Fix]** Fixes the following CVEs:  
    * TKGI API: Diffie-Hellman <= 1024 bits vulnerability [CVE-2015-4000](https://nvd.nist.gov/vuln/detail/CVE-2015-4000).  
* Fixes [Docker Commands No Longer Work on Worker VMs](#1-13-4-docker-commands-disabled).  
* Fixes [Automatic vSphere CSI Driver Integration Ignores Proxy Configuration](#1-13-0-csi-proxy-issue).  
* Fixes [Custom BOSH vm_extensions Configuration Settings Toggle On and Off](#1-13-0-vm-extensions-toggle).  
* Fixes [VMDKs Are Deleted during Migration from In-Tree Storage to CSI](#1-13-0-vmdks-deleted-during-migration).  

<%#
* Fixes [](#1-13-0-).      
* Fixes the following CVEs:  
  *  [CVE-2021-](https://nvd.nist.gov/vuln/detail/CVE-2021-).  
* Component bumps fix the following CVEs:  
    *  [CVE-2021-](https://nvd.nist.gov/vuln/detail/CVE-2021-): .  
    #%>

### <a id="1-13-6-deprecations"></a><a id="1-13-6-upcoming-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Upcoming Deprecations](#1-13-0-upcoming-deprecations) in the
<%= vars.k8s_runtime_abbr %> v1.13.0 Release Notes below.

###<a id="1-13-6-known-issues"></a>Known Issues

Except where noted, the known issues in <%= vars.product_short %> v1.13.5
are also in <%= vars.product_short %> v1.13.6.
See the <%= vars.k8s_runtime_abbr %> v1.13.5 [Known Issues](#1-13-5-known-issues) below.

For Known Issues in NCP v3.2.1.1, see
[NSX Container Plugin 3.2.1.1 Release Notes](https://docs.vmware.com/en/VMware-NSX-Container-Plugin/3.2.1.1/rn/vmware-nsx-container-plugin-3211-release-notes/index.html).

<hr>

#### <a id="1-13-6-windows-cluster-ncp-issue"></a> Kubernetes Services Cannot be Accessed from a Windows Pod in some Windows Clusters

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.7](#1-13-7-bug-fixes).  

When accessing Kubernetes services from a Windows Pod in some Windows clusters, the following error appears:

```
curl: (7) Failed to connect to 192.168.1.1 port 8080: Timed out
```

The Windows Pod is unable to communicate with the Kubernetes service. 

<hr>

## <a id="management-console-1-13-6"></a> <%= vars.k8s_runtime_abbr %> Management Console v1.13.6

**Release Date**: June 29, 2022

<p class="note"><strong>Note</strong>: <%= vars.product_short %> Management Console provides an opinionated
    installation of <%= vars.k8s_runtime_abbr %>. The supported versions may differ from or be more limited than
    what is generally supported by <%= vars.k8s_runtime_abbr %>.
</p>

### <a id="management-console-1-13-6-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Element</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://customerconnect.vmware.com/downloads/details?downloadGroup=TKGIMC-1130&productId=1231&rPId=79290">v1.13.6</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>June 29, 2022</td>
    </tr>
    <tr>
        <td>Installed <%= vars.k8s_runtime_abbr %> version</td>
        <td colspan=2><a href="#1-13-6">v1.13.6</a></td>
    </tr>
    <tr>
        <td>Installed Ops Manager version</td>
        <td>v2.10.43</td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/ops-manager/2-10/release-notes.html#2-10-37">Release Notes</a></td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Installed Kubernetes version</td>
        <td>v1.22.7&#42;</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1225">Release Notes</a></td>
    </tr>
    <tr>
        <td>Installed Harbor Registry version</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1109857">v2.5.1&#42;</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.5.1">Release Notes</a></td>
    </tr>
    <tr>
        <td>Linux stemcell</td>
        <td colspan=2>v621.252&#42;</td>
    </tr>
    <%#
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.44 and later</td>
    </tr>
    #%>
</table>

<a id="management-console-1-13-6-component-updates"></a>&#42; Components marked with an asterisk have been updated.

### <a id="management-console-1-13-6-upgrade"></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> Management Console v1.13.6 are from
<%= vars.k8s_runtime_abbr %> MC v1.13.5 and earlier <%= vars.k8s_runtime_abbr %> v1.13 patches, and from
<%= vars.k8s_runtime_abbr %> MC v1.12.6 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  

### <a id="management-console-1-13-6-features"></a>Features and Resolved Issues

<%= vars.k8s_runtime_abbr %> Management Console v1.13.6 has the following features and enhancements:  


<%#
This release of the <  %= vars.product_short %  > Management Console includes no new features or resolved issues.      
This release of the TKGI Management Console includes no new features or resolved issues.
< %= vars.k8s_runtime_abbr % > Management Console v1.13.6 has the following features and enhancements:
< %= vars.k8s_runtime_abbr % > Management Console v1.13.6 has the following resolved issues:  
* Fixes [](#management-console-1-13-0-).  
 #%>
 
### <a id="management-console-1-13-6-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Deprecations](#management-console-1-13-0-deprecations) in the
<%= vars.k8s_runtime_abbr %> MC v1.13.0 Release Notes below.

### <a id="management-console-1-13-6-known-issues"></a> Known Issues

Except where noted, the known issues in <%= vars.product_short %> Management Console v1.13.4
are also in <%= vars.product_short %> Management Console v1.13.6.
See the <%= vars.k8s_runtime_abbr %> MC v1.13.5 [Known Issues](#management-console-1-13-5-known-issues) below.

<hr>

## <a id="1-13-5"></a><%= vars.k8s_runtime_abbr %> v1.13.5

**Release Date**: May 23, 2022


### <a id="1-13-5-snapshot"></a><a id="product-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Release</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://network.pivotal.io/products/pivotal-container-service#/releases/1098411">v1.13.5</a></td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>May 23, 2022</td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Antrea</td>
        <td>v1.3.1-1.2.3</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-Container-Networking-with-Antrea/1.3.1/rn/VMware-Container-Networking-with-Antrea-Version-131-123-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>cAdvisor</td>
        <td colspan=2>v0.39.1</td>
    </tr>
    <tr>
        <td>Containerd for Linux</td>
        <td colspan=2>v1.5.9</td>
    </tr>
    <tr>
        <td>CoreDNS</td>
        <td colspan=2>v1.8.4+vmware.7</td>
    </tr>
    <tr>
        <td>CSI Driver for vSphere</td>
        <td>v2.4.1</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-vSphere-Container-Storage-Plug-in/2.4/rn/vmware-vsphere-container-storage-plugin-24-release-notes/index.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Docker</td>
        <td colspan=2>Linux: v20.10.9<br>Windows: v20.10.7</td>
    </tr>
    <tr>
        <td>etcd</td>
        <td colspan=2>v3.5.4&#42;</td>
    </tr>
    <tr>
        <td>Harbor</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1089256">v2.5.0&#42;</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.5.0">Release Notes</a></td>
    </tr>
    </tr>
    <tr>
        <td>Kubernetes</td>
        <td>v1.22.6</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1225">Release Notes</a></td>
    </tr>
    <tr>
        <td>Metrics Server</td>
        <td colspan=2>v0.5.0</td>
    </tr>
    <tr>
        <td>NCP</td>
        <td>v3.2.0.3</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3203-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Percona XtraDB Cluster (PXC)</td>
        <td colspan=2>v0.42.0</td>
    </tr>
    <tr>
        <td>UAA</td>
        <td colspan=2>v74.5.39&#42;</td>
    </tr>
    <tr>
        <td>Velero</td>
        <td><a href="https://customerconnect.vmware.com/downloads/get-download?downloadGroup=VELERO-163">v1.6.3</a></td>
        <td style="text-align: center;"><a href="https://github.com/vmware-tanzu/velero/releases/tag/v1.6.3">Release Notes</a></td>
    </tr>
    <tr>
        <td>Wavefront</td>
        <td colspan=2>Wavefront Collector: v1.7.1<br>Wavefront Proxy: v10.13</td>
    </tr>
    <tr>
        <th>Compatibilities</th>
        <th colspan=2>Versions</th>
    </tr>
    <tr>
        <td>Ops Manager</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service#/releases/1098411"><%= vars.product_network %></a>.</td>
    </tr>
    <tr>
        <td>NSX-T</td>
        <td rowspan=2 colspan=2>See <a href="https://interopmatrix.vmware.com/Interoperability?col=644&row=0,">VMware Product Interoperability Matrices</a>.</td></td>
        <%# All versions link: https://interopmatrix.vmware.com/Interoperability?col=644&row=0, #%>
    </tr>
    <tr>
        <td>vSphere</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.46 or later</td>
    </tr>
    <tr>
        <td>Xenial stemcells</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service#/releases/1098411"><%= vars.product_network %></a>.</td>
    </tr>
</table>

<a id="1-13-5-component-updates"></a>&#42; Components marked with an asterisk have been updated.  
&#42;&#42; To use Policy API features, you must use NSX-T v3.1.3.  


### <a id="1-13-5-upgrade"></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> v1.13.5 are from 
<%= vars.k8s_runtime_abbr %> v1.13.4 and earlier <%= vars.k8s_runtime_abbr %> v1.13 patches, and from
<%= vars.k8s_runtime_abbr %> v1.12.6 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  


### <a id="1-13-5-breaking-changes"></a>Breaking Changes

<%= vars.k8s_runtime_abbr %> v1.13.5 has the following breaking changes:  

* The kube-apiserver `audit.log` file is in a new location:  
    * Location in <%= vars.k8s_runtime_abbr %> v1.13.4 and earlier: `/var/vcap/sys/log/kube-apiserver/audit.log`  
    * Location in <%= vars.k8s_runtime_abbr %> v1.13.5 and later: `/var/vcap/sys/log/kube-apiserver/audit/log/audit.log`  
    

### <a id="1-13-5-features"></a><a id="1-13-5-enhancements"></a>Features and Enhancements

<%= vars.k8s_runtime_abbr %> v1.13.5 has the following features:

* Supports configuring the <%= vars.control_plane %> Operation Timeout length. For more information, 
see [Networking](installing-nsx-t.html#networking) in _Installing <%= vars.k8s_runtime_abbr %> on vSphere with NSX-T_.  


### <a id="1-13-5-bug-fixes"></a>Resolved Issues

<%= vars.k8s_runtime_abbr %> v1.13.5 has the following resolved issues:

<%#    * Fixes [Automatic vSphere CSI Driver Integration Ignores Proxy Configuration](#1-13-0-csi-proxy-issue).      #%>
* Fixes [Switching Cluster Container Runtimes Two or More Times Fails on Clusters with vROps Enabled](#1-13-4-runtime-switch-error-vrops).  
* Fixes [kube-apiserver Logs Occupy More Disk Space than Allocated](#1-13-0-logs-growing).  





<%#
* Fixes [](#1-13-0-).      
* Fixes the following CVEs:  
  *  [CVE-2021-](https://nvd.nist.gov/vuln/detail/CVE-2021-).  
* Component bumps fix the following CVEs:  
    *  [CVE-2021-](https://nvd.nist.gov/vuln/detail/CVE-2021-): .  
    #%>

### <a id="1-13-5-deprecations"></a><a id="1-13-5-upcoming-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Upcoming Deprecations](#1-13-0-upcoming-deprecations) in the
<%= vars.k8s_runtime_abbr %> v1.13.0 Release Notes below.

###<a id="1-13-5-known-issues"></a>Known Issues

Except where noted, the known issues in <%= vars.product_short %> v1.13.4
are also in <%= vars.product_short %> v1.13.5.
See the <%= vars.k8s_runtime_abbr %> v1.13.4 [Known Issues](#1-13-4-known-issues) below.

For Known Issues in NCP v3.2.0.3, see
[NSX Container Plugin 3.2.0.3 Release Notes](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3203-Release-Notes.html).

<hr>


## <a id="management-console-1-13-5"></a> <%= vars.k8s_runtime_abbr %> Management Console v1.13.5

**Release Date**: May 23, 2022

<p class="note"><strong>Note</strong>: <%= vars.product_short %> Management Console provides an opinionated
    installation of <%= vars.k8s_runtime_abbr %>. The supported versions may differ from or be more limited than
    what is generally supported by <%= vars.k8s_runtime_abbr %>.
</p>

### <a id="management-console-1-13-5-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Element</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://customerconnect.vmware.com/downloads/details?downloadGroup=TKGIMC-1130&productId=1231">v1.13.5</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>May 23, 2022</td>
    </tr>
    <tr>
        <td>Installed <%= vars.k8s_runtime_abbr %> version</td>
        <td colspan=2><a href="#1-13-5">v1.13.5</a></td>
    </tr>
    <tr>
        <td>Installed Ops Manager version</td>
        <td>v2.10.39</td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/ops-manager/2-10/release-notes.html#2-10-37">Release Notes</a></td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Installed Kubernetes version</td>
        <td>v1.22.6</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1225">Release Notes</a></td>
    </tr>
    <tr>
        <td>Installed Harbor Registry version</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1067541">v2.5.0&#42;</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.2">Release Notes</a></td>
    </tr>
    <tr>
        <td>Linux stemcell</td>
        <td colspan=2>v621.236&#42;</td>
    </tr>
    <%#
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.44 and later</td>
    </tr>
    #%>
</table>

<a id="management-console-1-13-5-component-updates"></a>&#42; Components marked with an asterisk have been updated.

### <a id="management-console-1-13-5-upgrade"></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> Management Console v1.13.5 are from
<%= vars.k8s_runtime_abbr %> MC v1.13.4 and earlier <%= vars.k8s_runtime_abbr %> v1.13 patches, and from
<%= vars.k8s_runtime_abbr %> MC v1.12.6 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  

### <a id="management-console-1-13-5-features"></a>Features and Resolved Issues

<%= vars.k8s_runtime_abbr %> Management Console v1.13.5 has the following features and enhancements:  

* Supports configuring the <%= vars.control_plane %> Operation Timeout length.  
<br>
    Configure the <%= vars.control_plane %> Operation Timeout by modifying the `nsx_feign_client_read_timeout` property 
    in the <%= vars.k8s_runtime_abbr %> MC Configuration File. 
    For more information, see [Generate Configuration File and Deploy Tanzu Kubernetes Grid Integrated Edition](console-deploy-wizard.html#deploy) 
    in _Deploy <%= vars.k8s_runtime_abbr %> by Using the Configuration Wizard_.  

<%#
This release of the <  %= vars.product_short %  > Management Console includes no new features or resolved issues.      
This release of the TKGI Management Console includes no new features or resolved issues.
< %= vars.k8s_runtime_abbr % > Management Console v1.13.5 has the following features and enhancements:
< %= vars.k8s_runtime_abbr % > Management Console v1.13.5 has the following resolved issues:  
* Fixes [](#management-console-1-13-0-).  
 #%>
 
### <a id="management-console-1-13-5-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Deprecations](#management-console-1-13-0-deprecations) in the
<%= vars.k8s_runtime_abbr %> MC v1.13.0 Release Notes below.

### <a id="management-console-1-13-5-known-issues"></a> Known Issues

Except where noted, the known issues in <%= vars.product_short %> Management Console v1.13.4
are also in <%= vars.product_short %> Management Console v1.13.5.
See the <%= vars.k8s_runtime_abbr %> MC v1.13.4 [Known Issues](#management-console-1-13-4-known-issues) below.

<hr>

## <a id="1-13-4"></a><%= vars.k8s_runtime_abbr %> v1.13.4

**Release Date**: April 29, 2022


### <a id="1-13-4-snapshot"></a><a id="product-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Release</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://network.pivotal.io/products/pivotal-container-service#/releases/1090100">v1.13.4</a></td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>April 29, 2022</td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Antrea</td>
        <td>v1.3.1-1.2.3&#42;</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-Container-Networking-with-Antrea/1.3.1/rn/VMware-Container-Networking-with-Antrea-Version-131-123-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>cAdvisor</td>
        <td colspan=2>v0.39.1</td>
    </tr>
    <tr>
        <td>Containerd for Linux</td>
        <td colspan=2>v1.5.9</td>
    </tr>
    <tr>
        <td>CoreDNS</td>
        <td colspan=2>v1.8.4+vmware.7</td>
    </tr>
    <tr>
        <td>CSI Driver for vSphere</td>
        <td>v2.4.1</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-vSphere-Container-Storage-Plug-in/2.4/rn/vmware-vsphere-container-storage-plugin-24-release-notes/index.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Docker</td>
        <td colspan=2>Linux: v20.10.9<br>Windows: v20.10.7</td>
    </tr>
    <tr>
        <td>etcd</td>
        <td colspan=2>v3.5.3&#42;</td>
    </tr>
    <tr>
        <td>Harbor</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1067541">v2.4.2&#42;</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.2">Release Notes</a></td>
    </tr>
    </tr>
    <tr>
        <td>Kubernetes</td>
        <td>v1.22.6</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1225">Release Notes</a></td>
    </tr>
    <tr>
        <td>Metrics Server</td>
        <td colspan=2>v0.5.0</td>
    </tr>
    <tr>
        <td>NCP</td>
        <td>v3.2.0.3</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3203-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Percona XtraDB Cluster (PXC)</td>
        <td colspan=2>v0.42.0&#42;</td>
    </tr>
    <tr>
        <td>UAA</td>
        <td colspan=2>v74.5.37&#42;</td>
    </tr>
    <tr>
        <td>Velero</td>
        <td><a href="https://customerconnect.vmware.com/downloads/get-download?downloadGroup=VELERO-163">v1.6.3</a></td>
        <td style="text-align: center;"><a href="https://github.com/vmware-tanzu/velero/releases/tag/v1.6.3">Release Notes</a></td>
    </tr>
    <tr>
        <td>Wavefront</td>
        <td colspan=2>Wavefront Collector: v1.7.1<br>Wavefront Proxy: v10.13</td>
    </tr>
    <tr>
        <th>Compatibilities</th>
        <th colspan=2>Versions</th>
    </tr>
    <tr>
        <td>Ops Manager</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service#/releases/1090100"><%= vars.product_network %></a>.</td>
    </tr>
    <tr>
        <td>NSX-T</td>
        <td rowspan=2 colspan=2>See <a href="https://interopmatrix.vmware.com/Interoperability?col=644&row=0,">VMware Product Interoperability Matrices&#42;&#42;</a>.</td></td>
        <%# All versions link: https://interopmatrix.vmware.com/Interoperability?col=644&row=0, #%>
    </tr>
    <tr>
        <td>vSphere</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.46 or later</td>
    </tr>
    <tr>
        <td>Xenial stemcells</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service#/releases/1090100"><%= vars.product_network %></a>.</td>
    </tr>
</table>

<a id="1-13-4-component-updates"></a>&#42; Components marked with an asterisk have been updated.  
&#42;&#42; To use Policy API features, you must use NSX-T v3.1.3.  


### <a id="1-13-4-upgrade"></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> v1.13.4 are from 
<%= vars.k8s_runtime_abbr %> v1.13.3 and earlier <%= vars.k8s_runtime_abbr %> v1.13 patches, and from
<%= vars.k8s_runtime_abbr %> v1.12.5 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  

### <a id="1-13-4-breaking-changes"></a>Breaking Changes

<%= vars.k8s_runtime_abbr %> v1.13.4 has the following breaking changes:

* Docker commands on worker VMs' no longer work:  
    Clusters using the Docker container runtime no longer default to supporting Docker command line commands.
    For more information, see [Docker Commands No Longer Work on Worker VMs](#1-13-4-docker-commands-disabled) below.  

<%#
### <a id="1-13-4-features"></a><a id="1-13-4-enhancements"></a>Features and Enhancements

<  %= vars.k8s_runtime_abbr %  > v1.13.4 has the following features:
#%>

### <a id="1-13-4-features"></a><a id="1-13-4-enhancements"></a>Features and Enhancements

* Fluent Bit has been upgraded from v1.8.10 to v1.9.0.
For more information, see [Upgrade Notes](https://docs.fluentbit.io/manual/installation/upgrade-notes) in the Fluent Bit documentation.  

* OpenJDK has been upgraded to v11.0.14. 
For more information, see [OpenJDK v11.0.14 Released](https://mail.openjdk.java.net/pipermail/jdk-updates-dev/2022-January/011643.html) in the OpenJDK notification archives.  

* Antrea has been upgraded from v1.3.0 to v1.3.1. 
For more information, see [Integration of Antrea Container Clusters](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/administration/GUID-9197EF8A-7998-4D1B-B968-067007C56B5C.html).  


### <a id="1-13-4-bug-fixes"></a>Resolved Issues

<%= vars.k8s_runtime_abbr %> v1.13.4 has the following resolved issues:

* **[Security Fix]** Fixes the following CVEs:  
  * [Spring Application Remote Code Execution Vulnerability CVE-2022-22965](#1-13-0-cve-2022-22965).  
* **[Security Fix]** Component bumps fix the following:  
    * OpenJDK:  
        * For information on the resolved security issues, see [OpenJDK v11.0.14 Released](https://mail.openjdk.java.net/pipermail/jdk-updates-dev/2022-January/011643.html) 
        in the OpenJDK notification archives.  
* Fixes [Certificate Rotation Fails If the Cluster Has a Kubernetes Profile](#1-13-0-cert-rotate-stops).  
* Fixes [Cluster Upgrading Fails After Upgrading NSX-T and <%= vars.k8s_runtime_abbr %>](#1-13-0-containerd-sock-error).  
* Fixes [CoreDNS Pods Fail While Upgrading to <%= vars.k8s_runtime_abbr %> v1.12.5](https://docs.pivotal.io/tkgi/1-12/release-notes.html#1-12-5-coredns-pods-fail).  
* Fixes [Docker Service Fails While Upgrading Clusters to <%= vars.k8s_runtime_abbr %> v1.13.3](#1-13-3-docker-upgrade-fail).  
<%#* Fixes [Switching Docker Container Runtime to Containerd Container Runtime Might Fail](#1-13-3-runtime-switch-error).  #%>
* Component bumps fix the following Known Issues:  
    * etcd:  
        * Fixes [etcd v3.5.0 Data Corruption Under Heavy Loads](#1-13-0-etcd-3-5-0-data-corruption).  
    * Fluent Bit:  
        * Fixes [Fluent Bit DNS Resolution Timeout Failure](#1-13-2-fluentd-dns-error).  
<%# 
        * Fixes [Fluent Bit Does Not Merge Containerd Runtime Cluster Multi-Line Entries](https://docs.pivotal.io/tkgi/1-13/release-notes.html#1-13-2-fluentd-multiline).  
        * Fixes The logging prefix on containerd runtime cluster log entries is different than the logging prefix on Docker runtime cluster log entries.  
    * NCP:  
        * Fixes [Existing NSX-T Load Balancer Domain Ingress Rules Override Newer Subdomain Ingress Rules](https://docs.pivotal.io/tkgi/1-13/release-notes.html#1-13-0-ncp-k8s-122).      
    #%>


<%#
* Fixes [](#1-13-0-).      
* Fixes the following CVEs:  
  *  [CVE-2021-](https://nvd.nist.gov/vuln/detail/CVE-2021-).  
* Component bumps fix the following CVEs:  
    *  [CVE-2021-](https://nvd.nist.gov/vuln/detail/CVE-2021-): .  
    #%>

<%#
### <a id="1-13-4-breaking-changes"></a>Breaking Changes

<  %= vars.k8s_runtime_abbr %  > v1.13.4 has the following breaking changes:


### <a id="1-13-4-features"></a><a id="1-13-4-enhancements"></a>Features

< %= vars.k8s_runtime_abbr % > v1.13.4 has the following features and enhancements:

#### <a id="1-13-4-policy-api"></a>Supports NSX-T Policy API

Supports NSX-T Policy API for new installations.
See [Considerations for Using the NSX-T Policy API with TKGI](./nsxt-policy-api-considerations.html) and
[Networking](./installing-nsx-t.html#networking) in _Installing Tanzu Kubernetes Grid Integrated Edition on vSphere with NSX-T_. 

#### <a id="1-13-4-enhancements"></a>Additional Features
< %= vars.k8s_runtime_abbr % > v1.13.4 includes the following additional features: 
#%>




### <a id="1-13-4-deprecations"></a><a id="1-13-4-upcoming-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Upcoming Deprecations](#1-13-0-upcoming-deprecations) in the
<%= vars.k8s_runtime_abbr %> v1.13.0 Release Notes below.

###<a id="1-13-4-known-issues"></a>Known Issues

Except where noted, the known issues in <%= vars.product_short %> v1.13.3
are also in <%= vars.product_short %> v1.13.4.
See the <%= vars.k8s_runtime_abbr %> v1.13.3 [Known Issues](#1-13-3-known-issues) below.

For Known Issues in NCP v3.2.0.3, see
[NSX Container Plugin 3.2.0.3 Release Notes](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3203-Release-Notes.html).


<hr>

#### <a id="1-13-4-runtime-switch-error-vrops"></a> Switching Cluster Container Runtimes Two or More Times Fails on Clusters with vROps Enabled

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.5](#1-13-5-bug-fixes).  


Switching a cluster container runtime from Docker to containerd then back to Docker will fail if the cluster is configured with vROps enabled.  

**Symptom**

Switching a cluster container runtime from containerd to Docker fails and logs errors similar to the following:  

```
failed to load listeners: can't create unix socket /var/vcap/sys/run/docker/docker.sock: is a directory
```


**Explanation**

The vrops-cadvisor daemonset mounted `/var/vcap/sys/run/docker/docker.sock` because it did not exist.  



**Workaround**

To resolve this error:  

1. Run the following command to remove the `/var/vcap/sys/run/docker/docker.sock` directory from worker nodes:  

    ```
    bosh -d service-instance_CLUSTER-UUID ssh worker "rm -rf /var/vcap/sys/run/docker/docker.sock"
    ```
    
    Where `CLUSTER-UUID` is the BOSH deployment name of your cluster.  

1. To switch your cluster's container runtime, re-run your `<%= vars.k8s_runtime_abbr %> update-cluster` command.  

<hr>

#### <a id="1-13-4-docker-commands-disabled"></a> Docker Commands No Longer Work on Worker VMs

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.6](#1-13-6-bug-fixes).  

Clusters using the Docker container runtime no longer default to supporting Docker command line commands.

Supporting containerd as the default container runtime requires Docker-specific features incompatible with containerd are disabled by default.

**Workaround**

In an environment where you want to run Docker commands, complete one of the following:

* Export the Docker environments variables before using Docker commands:
    
    ```
    source /var/vcap/jobs/docker/bin/envrc
    ```
    
    For example:  

    ```
    source /var/vcap/jobs/docker/bin/envrc 

    docker images
    REPOSITORY                                                                   TAG                                        IMAGE ID       CREATED         SIZE
    ...                                                                          1a3337bb81890b6bb1848b5dd4565dfa5d124f38   ffb57751a939   3 months ago    182MB
    ```

* Use absolute Docker paths when referencing Docker:  

    ```
    /var/vcap/packages/docker/bin/docker --host unix:///var/vcap/sys/run/docker/docker.sock
    ```
    
    For example:  

    ```
    /var/vcap/packages/docker/bin/docker --host unix:///var/vcap/sys/run/docker/docker.sock images
    REPOSITORY                                                                   TAG                                        IMAGE ID       CREATED         SIZE
    ...                                                                          1a3337bb81890b6bb1848b5dd4565dfa5d124f38   ffb57751a939   3 months ago    182MB
    ```

<hr>

## <a id="management-console-1-13-4"></a> <%= vars.k8s_runtime_abbr %> Management Console v1.13.4

**Release Date**: April 29, 2022

<p class="note"><strong>Note</strong>: <%= vars.product_short %> Management Console provides an opinionated
    installation of <%= vars.k8s_runtime_abbr %>. The supported versions may differ from or be more limited than
    what is generally supported by <%= vars.k8s_runtime_abbr %>.
</p>

### <a id="management-console-1-13-4-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Element</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://customerconnect.vmware.com/downloads/details?downloadGroup=TKGIMC-1130&productId=1231">v1.13.4</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>April 29, 2022</td>
    </tr>
    <tr>
        <td>Installed <%= vars.k8s_runtime_abbr %> version</td>
        <td colspan=2><a href="#1-13-4">v1.13.4</a></td>
    </tr>
    <tr>
        <td>Installed Ops Manager version</td>
        <td>v2.10.37</td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/ops-manager/2-10/release-notes.html#2-10-37">Release Notes</a></td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Installed Kubernetes version</td>
        <td>v1.22.6</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1225">Release Notes</a></td>
    </tr>
    <tr>
        <td>Installed Harbor Registry version</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1067541">v2.4.2&#42;</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.2">Release Notes</a></td>
    </tr>
    <tr>
        <td>Linux stemcell</td>
        <td colspan=2>v621.224&#42;</td>
    </tr>
    <%#
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.44 and later</td>
    </tr>
    #%>
</table>

<a id="management-console-1-13-4-component-updates"></a>&#42; Components marked with an asterisk have been updated.

### <a id="management-console-1-13-4-upgrade"></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> Management Console v1.13.4 are from
<%= vars.k8s_runtime_abbr %> MC v1.13.3 and earlier <%= vars.k8s_runtime_abbr %> v1.13 patches, and from
<%= vars.k8s_runtime_abbr %> MC v1.12.5 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  

### <a id="management-console-1-13-4-features"></a>Features and Resolved Issues

<%= vars.k8s_runtime_abbr %> Management Console v1.13.4 has the following resolved issues:  

* Fixes [<%= vars.k8s_runtime_abbr %> MC Validation Error If the Deployment DNS IP Address Is Reconfigured after Installing <%= vars.k8s_runtime_abbr %> in a BYOT Environment](#management-console-1-13-0-revise-dns-error).

<%#
This release of the <  %= vars.product_short %  > Management Console includes no new features or resolved issues.      
This release of the TKGI Management Console includes no new features or resolved issues.
< %= vars.k8s_runtime_abbr % > Management Console v1.13.4 has the following features and enhancements:
< %= vars.k8s_runtime_abbr % > Management Console v1.13.4 has the following resolved issues:  
* Fixes [](#management-console-1-13-0-).  
 #%>
 
### <a id="management-console-1-13-4-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Deprecations](#management-console-1-13-0-deprecations) in the
<%= vars.k8s_runtime_abbr %> MC v1.13.0 Release Notes below.

### <a id="management-console-1-13-4-known-issues"></a> Known Issues

Except where noted, the known issues in <%= vars.product_short %> Management Console v1.13.3
are also in <%= vars.product_short %> Management Console v1.13.4.
See the <%= vars.k8s_runtime_abbr %> MC v1.13.3 [Known Issues](#management-console-1-13-3-known-issues) below.

<hr>



## <a id="1-13-3"></a><%= vars.k8s_runtime_abbr %> v1.13.3

**Release Date**: March 11, 2022

<p class="note warning"><strong>Warning:</strong> The etcd maintainers do not recommend using etcd v3.5.0 for production environments due to a data corruption that might occur under heavy loads. 
For more information, see <a href="#1-13-0-etcd-3-5-0-data-corruption">etcd v3.5.0 Data Corruption Under Heavy Loads</a> in <i>Known Issues</i> below.
</p> 


<p class="note warning"><strong>Warning:</strong> Spring MVC and Spring WebFlux JDK 9+ applications running on Tomcat 
as a WAR deployment are vulnerable to remote code execution via data binding. 
For more information, see <a href="#1-13-0-cve-2022-22965">Spring Application Remote Code Execution Vulnerability CVE-2022-22965</a>.
</p> 

<%#
<p class="note warning"><strong>Warning:</strong> If you deploy 
<  %= vars.k8s_runtime_abbr %  > on vSphere with NSX-T 
and your load balancer ingress rules include both domain and subdomain ingress rules, 
<  %= vars.recommended_by %  > recommends that you upgrade to 
<  %= vars.k8s_runtime_abbr %  > v1.13.3 or later. 
For more information, see <a href="#1-13-0-ncp-k8s-122">Existing NSX-T Load Balancer Domain Ingress Rules Override Newer Subdomain Ingress Rules</a> below.  
</p> 
#%>


### <a id='1-13-3-snapshot'></a><a id='product-snapshot'></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Release</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://network.pivotal.io/products/pivotal-container-service#/releases/1058310">v1.13.3</a></td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>March 11, 2022</td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Antrea</td>
        <td>v1.3.0-1.2.2</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-Container-Networking-with-Antrea/1.3/rn/VMware-Container-Networking-with-Antrea-Version-130-122-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>cAdvisor</td>
        <td colspan=2>v0.39.1</td>
    </tr>
    <tr>
        <td>Containerd for Linux</td>
        <td colspan=2>v1.5.9</td>
    </tr>
    <tr>
        <td>CoreDNS</td>
        <td colspan=2>v1.8.4+vmware.7</td>
    </tr>
    <tr>
        <td>CSI Driver for vSphere</td>
        <td>v2.4.1</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-vSphere-Container-Storage-Plug-in/2.4/rn/vmware-vsphere-container-storage-plugin-24-release-notes/index.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Docker</td>
        <td colspan=2>Linux: v20.10.9<br>Windows: v20.10.7</td>
    </tr>
    <tr>
        <td>etcd</td>
        <td colspan=2>v3.5.0</td>
    </tr>
    <tr>
        <td>Harbor</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1017095">v2.4.1</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.1">Release Notes</a></td>
    </tr>
    </tr>
    <tr>
        <td>Kubernetes</td>
        <td>v1.22.6</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1225">Release Notes</a></td>
    </tr>
    <tr>
        <td>Metrics Server</td>
        <td colspan=2>v0.5.0</td>
    </tr>
    <tr>
        <td>NCP</td>
        <td>v3.2.0.3</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3203-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Percona XtraDB Cluster (PXC)</td>
        <td colspan=2>v0.41.0</td>
    </tr>
    <tr>
        <td>UAA</td>
        <td colspan=2>v74.5.35&#42;</td>
    </tr>
    <tr>
        <td>Velero</td>
        <td><a href="https://customerconnect.vmware.com/downloads/get-download?downloadGroup=VELERO-163">v1.6.3</a></td>
        <td style="text-align: center;"><a href="https://github.com/vmware-tanzu/velero/releases/tag/v1.6.3">Release Notes</a></td>
    </tr>
    <tr>
        <td>Wavefront</td>
        <td colspan=2>Wavefront Collector: v1.7.1<br>Wavefront Proxy: v10.13</td>
    </tr>
    <tr>
        <th>Compatibilities</th>
        <th colspan=2>Versions</th>
    </tr>
    <tr>
        <td>Ops Manager</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service#/releases/1058310"><%= vars.product_network %></a>.</td>
    </tr>
    <tr>
        <td>NSX-T</td>
        <td rowspan=2 colspan=2>See <a href="https://interopmatrix.vmware.com/Interoperability?col=644&row=0,">VMware Product Interoperability Matrices&#42;&#42;</a>.</td></td>
        <%# All versions link: https://interopmatrix.vmware.com/Interoperability?col=644&row=0, #%>
    </tr>
    <tr>
        <td>vSphere</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.45 or later</td>
    </tr>
    <tr>
        <td>Xenial stemcells</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service#/releases/1058310"><%= vars.product_network %></a>.</td>
    </tr>
</table>

<a id="1-13-3-component-updates"></a>&#42; Components marked with an asterisk have been updated.  
&#42;&#42; To use Policy API features, you must use NSX-T v3.1.3.  


### <a id='1-13-3-upgrade'></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> v1.13.3 are from 
<%= vars.k8s_runtime_abbr %> v1.13.2 and earlier <%= vars.k8s_runtime_abbr %> v1.13 patches, and from
<%= vars.k8s_runtime_abbr %> v1.12.4 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  


### <a id="1-13-3-features"></a><a id="1-13-3-enhancements"></a>Features and Enhancements

<%= vars.k8s_runtime_abbr %> v1.13.3 has the following features:

#### <a id="1-13-3-migrate-container-runtime"></a>Supports Migrating Clusters between Container Runtimes

Kubernetes has deprecated Docker container runtime support and all Docker-runtime clusters must be 
switched to use the containerd container runtime prior to upgrading to <%= vars.k8s_runtime_abbr %> v1.15.  

The <%= vars.k8s_runtime_abbr %> v1.14 cluster upgrade will automatically switch clusters to the containerd container runtime.  

<p class="note warning"><strong>Warning</strong>:  Cluster workloads will experience downtime while the cluster switches 
    from using the Docker runtime to containerd.
</p>

In <%= vars.k8s_runtime_abbr %> v1.13.3 and later, the  `tkgi update-cluster` CLI command includes options to 
prepare your clusters for the removal of Docker-runtime support:  

* Supports switching an existing cluster between container runtimes:  

    * From a Docker container runtime to the containerd-runtime.  
    * From a containerd container runtime to a Docker-runtime.  <br>

    For more information, see [Switch a Cluster to a Different Container Runtime](upgrade-clusters.html#migrate-runtime) in _Upgrading Clusters_.  

* Supports locking a cluster to the Docker container runtime:  
<br>
    Locking a cluster to the Docker container runtime prevents the <%= vars.k8s_runtime_abbr %> v1.14 cluster upgrade 
    from automatically switching the cluster to the containerd-runtime.  
    <br>
    For more information, see 
    [Lock a Cluster to the Docker Container Runtime](upgrade-clusters.html#lock-runtime) in _Upgrading Clusters_ 
    and [Create a Kubernetes Cluster](create-cluster.html#create) in _Creating Clusters_.  

    <p class="note"><strong>Note:</strong> 
    All Docker-runtime clusters must be switched to the containerd-runtime prior to upgrading to <%= vars.k8s_runtime_abbr %> v1.15.  
    </p>
    
For more information, see [Customize Cluster Container Runtimes Before Upgrading](upgrade-clusters.html#upgrade-runtime) in _Upgrading Clusters_.  


<p class="note warning"><strong>Warning:</strong> 
Clusters that are not locked to the Docker-runtime will automatically switch to the containerd container runtime 
during the <%= vars.k8s_runtime_abbr %> v1.14 cluster upgrade.
</p>


<%#
    ### <    a id="1-13-3-breaking-changes"></a>Breaking Changes

<  %= vars.k8s_runtime_abbr %  > v1.13.3 has the following breaking changes:


    ### <    a id="1-13-3-features"></a><a id="1-13-3-enhancements"></a>Features

< %= vars.k8s_runtime_abbr % > v1.13.3 has the following features and enhancements:

    #### <    a id="1-13-3-policy-api"></a>Supports NSX-T Policy API

Supports NSX-T Policy API for new installations.
See [Considerations for Using the NSX-T Policy API with TKGI](./nsxt-policy-api-considerations.html) and
[Networking](./installing-nsx-t.html#networking) in _Installing Tanzu Kubernetes Grid Integrated Edition on vSphere with NSX-T_. 

    #### <    a id="1-13-3-enhancements"></a>Additional Features
< %= vars.k8s_runtime_abbr % > v1.13.3 includes the following additional features: 
#%>


### <a id="1-13-3-bug-fixes"></a>Resolved Issues

<%= vars.k8s_runtime_abbr %> v1.13.3 has the following resolved issues:

* Fixes [Cluster Migration from Flannel to Antrea Can Fail for Certain CIDR Addresses](#1-13-0-128-antrea-migration).  

<%#
* Fixes [Cluster Upgrading Fails After Upgrading NSX-T and <  %= vars.k8s_runtime_abbr %  >](#1-13-0-containerd-sock-error).      
* Fixes the following CVEs:  
  *  [CVE-2021-](https://nvd.nist.gov/vuln/detail/CVE-2021-).  
* Component bumps fix the following CVEs:  
    *  [CVE-2021-](https://nvd.nist.gov/vuln/detail/CVE-2021-): .  
    #%>

### <a id="1-13-3-deprecations"></a><a id="1-13-3-upcoming-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Upcoming Deprecations](#1-13-0-upcoming-deprecations) in the
<%= vars.k8s_runtime_abbr %> v1.13.0 Release Notes below.

###<a id='1-13-3-known-issues'></a>Known Issues

Except where noted, the known issues in <%= vars.product_short %> v1.13.2
are also in <%= vars.product_short %> v1.13.3.
See the <%= vars.k8s_runtime_abbr %> v1.13.2 [Known Issues](#1-13-2-known-issues) below.

<p class="note warning"><strong>Warning:</strong> The etcd maintainers do not recommend using etcd v3.5.0 for production environments due to a data corruption that might occur under heavy loads. 
For more information, see <a href="#1-13-0-etcd-3-5-0-data-corruption">etcd v3.5.0 Data Corruption Under Heavy Loads</a> in <i>Known Issues</i> below.  
</p> 

<p class="note warning"><strong>Warning:</strong> Spring MVC and Spring WebFlux JDK 9+ applications running on Tomcat 
as a WAR deployment are vulnerable to remote code execution via data binding. 
For more information, see <a href="#1-13-0-cve-2022-22965">Spring Application Remote Code Execution Vulnerability CVE-2022-22965</a>.
</p> 

For Known Issues in NCP v3.2.0.3, see
[NSX Container Plugin 3.2.0.3 Release Notes](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3203-Release-Notes.html).


<hr>

#### <a id="1-13-3-docker-upgrade-fail"></a> Docker Service Fails While Upgrading Clusters to <%= vars.k8s_runtime_abbr %> v1.13.3

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.4](#1-13-4-bug-fixes).   

The Docker service might fail for some Docker container runtime clusters while upgrading the clusters from 
<%= vars.k8s_runtime_abbr %> v1.13.2 to <%= vars.k8s_runtime_abbr %> v1.13.3.  


**Symptoms**

While upgrading Docker container runtime clusters to <%= vars.k8s_runtime_abbr %> v1.13.3, the cluster upgrade fails and logs errors similar to the following:  

```
...operation: update, error-message: 'worker-... (1)' is not running after update. Review logs for failed jobs: docker...
```

```
...worker/...:~# monit summary The Monit daemon 5.2.5 uptime: 1m Process 'docker' Execution failed
```

```
...msg="Handler for POST /v1.41/images/create returned error: Get \"https://registry.tkg.vmware.run/v2/\": dial tcp: lookup registry.tkg.vmware.run on ...: no such host..."
```

**Workaround**

If upgrading a Docker container runtime cluster to <%= vars.k8s_runtime_abbr %> v1.13.3 has failed:  

1. Restart the Docker process on that cluster.  
1. If any Pods in the cluster return `Warning FailedCreatePodSandBox`, you must recreate the affected worker node.  

<hr>
<%#

#### <a id="1-13-3-runtime-switch-error"></a> Switching Docker Container Runtime to Containerd Container Runtime Might Fail

This issue is fixed in [<  %= vars.k8s_runtime_abbr %  > v1.13.4](#1-13-4-bug-fixes).  

Switching a cluster container runtime from Docker to containerd will fail if the cluster is configured with the following parameters:

```
    "unset_http_proxy": ["docker"]
```

**Symptom**

Switching a cluster container runtime from Docker to containerd fails and the container runtime switching log includes an error similar to the following:  

```
Error: Status: 500; ErrorMessage: <nil>; Description: Could not get ops: Invalid job type for unset_http_proxy :'docker', the job type should be runtime; ResponseError: <nil>
```

<hr>
#%>


## <a id="management-console-1-13-3"></a> <%= vars.k8s_runtime_abbr %> Management Console v1.13.3

**Release Date**: March 11, 2022

<p class="note"><strong>Note</strong>: <%= vars.product_short %> Management Console provides an opinionated
    installation of <%= vars.k8s_runtime_abbr %>. The supported versions may differ from or be more limited than
    what is generally supported by <%= vars.k8s_runtime_abbr %>.
</p>

### <a id="management-console-1-13-3-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Element</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://customerconnect.vmware.com/downloads/details?downloadGroup=TKGIMC-1130&productId=1231">v1.13.3</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>March 11, 2022</td>
    </tr>
    <tr>
        <td>Installed <%= vars.k8s_runtime_abbr %> version</td>
        <td colspan=2><a href="#1-13-3">v1.13.3</a></td>
    </tr>
    <tr>
        <td>Installed Ops Manager version</td>
        <td>v2.10.32</td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/ops-manager/2-10/release-notes.html#2-10-32">Release Notes</a></td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Installed Kubernetes version</td>
        <td>v1.22.6</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1225">Release Notes</a></td>
    </tr>
    <tr>
        <td>Installed Harbor Registry version</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1017095">v2.4.1</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.1">Release Notes</a></td>
    </tr>
    <tr>
        <td>Linux stemcell</td>
        <td colspan=2>v621.211&#42;</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.44 and later</td>
    </tr>
</table>

<a id="management-console-1-13-3-component-updates"></a>&#42; Components marked with an asterisk have been updated.

### <a id='management-console-1-13-3-upgrade'></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> Management Console v1.13.3 are from
<%= vars.k8s_runtime_abbr %> MC v1.13.2 and earlier <%= vars.k8s_runtime_abbr %> v1.13 patches, and from
<%= vars.k8s_runtime_abbr %> MC v1.12.4 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  

### <a id="management-console-1-13-3-features"></a>Features and Resolved Issues

<%= vars.k8s_runtime_abbr %> Management Console v1.13.3 has the following resolved issues:  

* Fixes [TKGI MC Validation Error If the Deployment DNS IP Address Is Reconfigured after Installing TKGI in a BYOT Environment](#management-console-1-13-0-revise-dns-error).  
<%#
This release of the <  %= vars.product_short %  > Management Console includes no new features or resolved issues.      
This release of the TKGI Management Console includes no new features or resolved issues.
< %= vars.k8s_runtime_abbr % > Management Console v1.13.3 has the following features and enhancements:
< %= vars.k8s_runtime_abbr % > Management Console v1.13.3 has the following resolved issues:  
 #%>
 
### <a id="management-console-1-13-3-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Deprecations](#management-console-1-13-0-deprecations) in the
<%= vars.k8s_runtime_abbr %> MC v1.13.0 Release Notes below.

### <a id="management-console-1-13-3-known-issues"></a> Known Issues

Except where noted, the known issues in <%= vars.product_short %> Management Console v1.13.1
are also in <%= vars.product_short %> Management Console v1.13.3.
See the <%= vars.k8s_runtime_abbr %> MC v1.13.1 [Known Issues](#management-console-1-13-1-known-issues) below.

<hr>


## <a id="1-13-2"></a><%= vars.k8s_runtime_abbr %> v1.13.2

**Release Date**: February 17, 2022

<p class="note warning"><strong>Warning:</strong> The etcd maintainers do not recommend using etcd v3.5.0 for production environments due to a data corruption that might occur under heavy loads. 
For more information, see <a href="#1-13-0-etcd-3-5-0-data-corruption">etcd v3.5.0 Data Corruption Under Heavy Loads</a> in <i>Known Issues</i> below.  
</p> 


<p class="note warning"><strong>Warning:</strong> Spring MVC and Spring WebFlux JDK 9+ applications running on Tomcat 
as a WAR deployment are vulnerable to remote code execution via data binding. 
For more information, see <a href="#1-13-0-cve-2022-22965">Spring Application Remote Code Execution Vulnerability CVE-2022-22965</a>.
</p> 
<%#
<p class="note warning"><strong>Warning:</strong> If you deploy 
    <  %= vars.k8s_runtime_abbr %  > on vSphere with NSX-T 
and your load balancer ingress rules include both domain and subdomain ingress rules, 
<  %= vars.recommended_by %  > recommends that you upgrade to 
<  %= vars.k8s_runtime_abbr %  > v1.13.2 or later. 
For more information, see <a href="#1-13-0-ncp-k8s-122">Existing NSX-T Load Balancer Domain Ingress Rules Override Newer Subdomain Ingress Rules</a> below.  
</p> 
#%>


### <a id='1-13-2-snapshot'></a><a id='product-snapshot'></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Release</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/1045836">v1.13.2</a></td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>February 17, 2022</td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Antrea</td>
        <td>v1.3.0-1.2.2</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-Container-Networking-with-Antrea/1.3/rn/VMware-Container-Networking-with-Antrea-Version-130-122-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>cAdvisor</td>
        <td colspan=2>v0.39.1</td>
    </tr>
    <tr>
        <td>Containerd for Linux</td>
        <td colspan=2>v1.5.9&#42;</td>
    </tr>
    <tr>
        <td>CoreDNS</td>
        <td colspan=2>v1.8.4+vmware.7&#42;</td>
    </tr>
    <tr>
        <td>CSI Driver for vSphere</td>
        <td>v2.4.1&#42;</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-vSphere-Container-Storage-Plug-in/2.4/rn/vmware-vsphere-container-storage-plugin-24-release-notes/index.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Docker</td>
        <td colspan=2>Linux: v20.10.9<br>Windows: v20.10.7</td>
    </tr>
    <tr>
        <td>etcd</td>
        <td colspan=2>v3.5.0</td>
    </tr>
    <tr>
        <td>Harbor</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1017095">v2.4.1</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.1">Release Notes</a></td>
    </tr>
    <tr>
        <td>Kubernetes</td>
        <td>v1.22.6&#42;</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1225">Release Notes</a></td>
    </tr>
    <tr>
        <td>Metrics Server</td>
        <td colspan=2>v0.5.0</td>
    </tr>
    <tr>
        <td>NCP</td>
        <td>v3.2.0.3&#42;</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3203-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Percona XtraDB Cluster (PXC)</td>
        <td colspan=2>v0.41.0&#42;</td>
    </tr>
    <tr>
        <td>UAA</td>
        <td colspan=2>v74.5.34&#42;</td>
    </tr>
    <tr>
        <td>Velero</td>
        <td><a href="https://customerconnect.vmware.com/downloads/get-download?downloadGroup=VELERO-163">v1.6.3</a></td>
        <td style="text-align: center;"><a href="https://github.com/vmware-tanzu/velero/releases/tag/v1.6.3">Release Notes</a></td>
    </tr>
    <tr>
        <td>Wavefront</td>
        <td colspan=2>Wavefront Collector: v1.7.1<br>Wavefront Proxy: v10.13&#42;</td>
    </tr>
    <tr>
        <th>Compatibilities</th>
        <th colspan=2>Versions</th>
    </tr>
    <tr>
        <td>Ops Manager</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/1045836"><%= vars.product_network %></a>.</td>
    </tr>
    <tr>
        <td>NSX-T</td>
        <td rowspan=2 colspan=2>See <a href="https://interopmatrix.vmware.com/Interoperability?col=644&row=0,">VMware Product Interoperability Matrices</a>.</td></td>
        <%# All versions link: https://interopmatrix.vmware.com/Interoperability?col=644&row=0, #%>
    </tr>
    <tr>
        <td>vSphere</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.44 or later&#42;&#42;&#42;</td>
    </tr>
    <tr>
        <td>Xenial stemcells</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/1045836"><%= vars.product_network %></a>.</td>
    </tr>
</table>

<a id="1-13-2-component-updates"></a>&#42; Components marked with an asterisk have been updated.  
&#42;&#42; To use Policy API features, you must use NSX-T v3.1.3.  
&#42;&#42;&#42; See [Deployments Fail on <%= vars.k8s_runtime_abbr %> Windows Worker-based Kubernetes Clusters after the January 2022 Microsoft Windows Security Patch](#1-13-0-stemcell-tar-support).  


### <a id='1-13-2-upgrade'></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> v1.13.2 are from 
<%= vars.k8s_runtime_abbr %> v1.13.1, v1.13.0, and from
<%= vars.k8s_runtime_abbr %> v1.12.3 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  


### <a id="1-13-2-features"></a><a id="1-13-2-enhancements"></a><a id="1-13-2-bug-fixes"></a>Resolved Issues

<%= vars.k8s_runtime_abbr %> v1.13.2 has the following resolved issues:

* Fixes the following CVEs:  
  * Apache Log4j vulnerability [CVE-2021-45105](https://nvd.nist.gov/vuln/detail/CVE-2021-45105).   
  * Open SSL vulnerability [CVE-2021-3711](https://nvd.nist.gov/vuln/detail/CVE-2021-3711).  
  * Open SSL vulnerability [CVE-2021-3712](https://nvd.nist.gov/vuln/detail/CVE-2021-3712).  
* Component bumps fix the following CVEs:  
    * containerd [CVE-2021-43816](https://nvd.nist.gov/vuln/detail/CVE-2021-43816): An unprivileged pod may bind mount any privileged regular file on disk for complete read/write access.  
* Fixes [<%= vars.k8s_runtime_abbr %> Does Not Support Updating Dedicated Tier 1 Clusters](#1-13-0-cannot-update-dedicated-tier1).  
* Fixes [Using a New Compute Profile to Add and Remove Node Pools Deletes and Recreates the Node Pool VMs](#1-13-0-update-remove-pool).  
* Fixes [The Tier-1 Gateway and Static Routes for the LoadBalancer CRD Are Not Deleted While Deleting Policy API-Based Clusters](#1-13-0-objects-not-deleted-with-cluster).  
* Fixes [Rotate-Certificates Returns 'Could Not Fetch VMs Info' When Rotating Certificates for More than 1000 Clusters](#1-13-0-1000-objects-error).  
* Fixes [Cluster Migration to the vSphere CSI Driver Does Not Support Air-Gapped Environments](#1-13-0-air-gapped-csi-migration).  
* Fixes [Multiple CoreDNS Pods Might Run On the Same Worker Node after Upgrading a Cluster](#1-13-0-multiple-coredns).  
* Fixes upgrade errand pre-start script failures in environments where an NSX-T logical port is tagged with a blank string.  
* Fixes occasional instances of 'Fault cause: vmodl.fault.InvalidArgument' errors during VCP to CSI migration.  
* Component bumps fix the following:  
    * [Existing NSX-T Load Balancer Domain Ingress Rules Override Newer Subdomain Ingress Rules](#1-13-0-ncp-k8s-122).  
    * The logging prefix on containerd runtime cluster log entries is no longer different than the prefix on Docker runtime cluster log entries.  
        * Fluent Bit has been upgraded from v1.5.7 to v1.8.10.
        For more information, see [Fluent Bit Does Not Merge Containerd Runtime Cluster Multi-Line Entries](#1-13-2-fluentd-multiline) below, and 
        [Upgrade Notes](https://docs.fluentbit.io/manual/installation/upgrade-notes) in the Fluent Bit documentation.  
    

### <a id="1-13-2-deprecations"></a><a id="1-13-2-upcoming-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Upcoming Deprecations](#1-13-0-upcoming-deprecations) in the
<%= vars.k8s_runtime_abbr %> v1.13.0 Release Notes below.

###<a id='1-13-2-known-issues'></a>Known Issues

Except where noted, the known issues in <%= vars.product_short %> v1.13.1
are also in <%= vars.product_short %> v1.13.2.
See the <%= vars.k8s_runtime_abbr %> v1.13.1 [Known Issues](#1-13-1-known-issues) below.

<p class="note warning"><strong>Warning:</strong> The etcd maintainers do not recommend using etcd v3.5.0 for production environments due to a data corruption that might occur under heavy loads. 
For more information, see <a href="#1-13-0-etcd-3-5-0-data-corruption">etcd v3.5.0 Data Corruption Under Heavy Loads</a> in <i>Known Issues</i> below.  
</p> 

<p class="note warning"><strong>Warning:</strong> Spring MVC and Spring WebFlux JDK 9+ applications running on Tomcat 
as a WAR deployment are vulnerable to remote code execution via data binding. 
For more information, see <a href="#1-13-0-cve-2022-22965">Spring Application Remote Code Execution Vulnerability CVE-2022-22965</a>.
</p> 

For Known Issues in NCP v3.2.0.3, see
[NSX Container Plugin 3.2.0.3 Release Notes](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3203-Release-Notes.html).  

<hr>

#### <a id="1-13-2-fluentd-multiline"></a> Fluent Bit Does Not Merge Containerd Runtime Cluster Multi-Line Entries

The Fluent Bit Docker, CRI, Go, Java, and Python multi-line parser does not merge containerd runtime cluster log entries 
belonging to the same context into a single log entry. 

<hr>


#### <a id="1-13-2-fluentd-dns-error"></a> Fluent Bit DNS Resolution Timeout Failure

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.4](#1-13-4-bug-fixes).  

Fluent Bit v1.8.5 and later might fail to forward Pod log entries to the desired logging destination and instead return a DNS timeout error.  

**Symptoms**

When Fluent Bit encounters this unexpected DNS resolution issue, it logs Fluent Bit errors similar to the following:  

```
[ warn] [engine] chunk '...' cannot be retried: task_id=1, input=tail.0 > output=splunk.0

[ warn] [net] getaddrinfo(host='...', err=11): Could not contact DNS servers

[ warn] [engine] failed to flush chunk '...', retry in 6 seconds: task_id=11, input=tail.0 > output=splunk.0 (out_id=0)

[ warn] [net] getaddrinfo(host='...', err=11): Could not contact DNS servers

```

**Workaround**

To resolve the Fluent Bit DNS timeout problem:

1. Open the Fluent Bit config map in a text editor.  
1. Add the following to the `OUTPUT` section in the config map:  

    ```
    net.dns.mode   TCP
    ```
    
    For more information on configuring a Fluent Bit ConfigMap, see
    [Installation](https://docs.fluentbit.io/manual/installation/kubernetes#installation) 
    in the _Fluent Bit Official Manual_ or the example ConfigMap files: 
    [kafka/fluent-bit-configmap.yaml](https://github.com/fluent/fluent-bit-kubernetes-logging/blob/master/output/kafka/fluent-bit-configmap.yaml) and 
    [elasticsearch/fluent-bit-configmap.yaml](https://github.com/fluent/fluent-bit-kubernetes-logging/blob/master/output/elasticsearch/fluent-bit-configmap.yaml) 
    in the Fluent Bit GitHub repository.  
    
1. Perform a rollout restart of Fluent Bit logging:

    ```
    kubectl logs POD-NAME -n NAMESPACE -c CONTAINER-NAME --follow
    ```
    
    Where:  
    * `POD-NAME` is the name of your Pod.  
    * `NAMESPACE` is the namespace for your Pod.  
    * `CONTAINER-NAME` is the name of your Pod container.  
<br>
    
    For more information on restarting Fluent Bit logging, see 
    [Interacting with running Pods](https://kubernetes.io/docs/reference/kubectl/cheatsheet/#interacting-with-running-pods) 
    in _kubectl Cheat Sheet_ in the Kubernetes documentation.  
    

For more information, see 
[DNS resolution timeout/failure in >= 1.8.5 #4050](https://github.com/fluent/fluent-bit/issues/4050) and 
[Malformed HTTP response from splunk and cannot increase buffer on fluentBit v1.8.9 #4723](https://github.com/fluent/fluent-bit/issues/4723) 
in the Fluent Bit GitHub repository.

<hr>


<hr>



## <a id="management-console-1-13-2"></a> <%= vars.k8s_runtime_abbr %> Management Console v1.13.2

**Release Date**: February 17, 2022

<p class="note"><strong>Note</strong>: <%= vars.product_short %> Management Console provides an opinionated
    installation of <%= vars.k8s_runtime_abbr %>. The supported versions may differ from or be more limited than
    what is generally supported by <%= vars.k8s_runtime_abbr %>.
</p>

### <a id="management-console-1-13-2-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Element</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://customerconnect.vmware.com/downloads/details?downloadGroup=TKGIMC-1130&productId=1231">v1.13.2</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>February 17, 2022</td>
    </tr>
    <tr>
        <td>Installed <%= vars.k8s_runtime_abbr %> version</td>
        <td colspan=2><a href="#1-13-2">v1.13.2</a></td>
    </tr>
    <tr>
        <td>Installed Ops Manager version</td>
        <td>v2.10.29</td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/ops-manager/2-10/release-notes.html#2-10-29">Release Notes</a></td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Installed Kubernetes version</td>
        <td>v1.22.6&#42;</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1225">Release Notes</a></td>
    </tr>
    <tr>
        <td>Installed Harbor Registry version</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1017095">v2.4.1</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.1">Release Notes</a></td>
    </tr>
    <tr>
        <td>Linux stemcell</td>
        <td colspan=2>v621.208&#42;</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.44 and later</td>
    </tr>
</table>


<a id="management-console-1-13-2-component-updates"></a>&#42; Components marked with an asterisk have been updated.

### <a id='management-console-1-13-2-upgrade'></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> Management Console v1.13.2 are from
<%= vars.k8s_runtime_abbr %> MC v1.13.1, v1.13.0, and from
<%= vars.k8s_runtime_abbr %> MC v1.12.3 and earlier <%= vars.k8s_runtime_abbr %> MC v1.12 patches.  

### <a id="management-console-1-13-2-features"></a>Features and Resolved Issues

This release of the <%= vars.product_short %> Management Console includes no new features or resolved issues.  
<%#
This release of the TKGI Management Console includes no new features or resolved issues.
< %= vars.k8s_runtime_abbr % > Management Console v1.13.2 has the following features and enhancements:
< %= vars.k8s_runtime_abbr % > Management Console v1.13.2 has the following resolved issues:  
 #%>
 
### <a id="management-console-1-13-2-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Deprecations](#management-console-1-13-0-deprecations) in the
<%= vars.k8s_runtime_abbr %> MC v1.13.0 Release Notes below.

### <a id="management-console-1-13-2-known-issues"></a> Known Issues

Except where noted, the known issues in <%= vars.product_short %> Management Console v1.13.1
are also in <%= vars.product_short %> Management Console v1.13.2.
See the <%= vars.k8s_runtime_abbr %> MC v1.13.1 [Known Issues](#management-console-1-13-1-known-issues) below.

<hr>

## <a id="1-13-1"></a><%= vars.k8s_runtime_abbr %> v1.13.1

**Release Date**: December 22, 2021


<p class="note warning"><strong>Warning:</strong> The etcd maintainers do not recommend using etcd v3.5.0 for production environments due to a data corruption that might occur under heavy loads. 
For more information, see <a href="#1-13-0-etcd-3-5-0-data-corruption">etcd v3.5.0 Data Corruption Under Heavy Loads</a> in <i>Known Issues</i> below.  
</p> 


<p class="note warning"><strong>Warning:</strong> Spring MVC and Spring WebFlux JDK 9+ applications running on Tomcat 
as a WAR deployment are vulnerable to remote code execution via data binding. 
For more information, see <a href="#1-13-0-cve-2022-22965">Spring Application Remote Code Execution Vulnerability CVE-2022-22965</a>.
</p> 
<%#
<p class="note warning"><strong>Warning:</strong> If you deploy 
    <  %= vars.k8s_runtime_abbr %  > on vSphere with NSX-T 
and your load balancer ingress rules include both domain and subdomain ingress rules, 
<  %= vars.recommended_by %  > recommends that you upgrade to 
<  %= vars.k8s_runtime_abbr %  > v1.13.2 or later. 
For more information, see <a href="#1-13-0-ncp-k8s-122">Existing NSX-T Load Balancer Domain Ingress Rules Override Newer Subdomain Ingress Rules</a> below.  
</p> 
#%>


### <a id='1-13-1-snapshot'></a><a id='product-snapshot'></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Release</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/1017574">v1.13.1</a></td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>December 22, 2021</td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Antrea</td>
        <td>v1.3.0-1.2.2</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-Container-Networking-with-Antrea/1.3/rn/VMware-Container-Networking-with-Antrea-Version-130-122-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>cAdvisor</td>
        <td colspan=2>v0.39.1</td>
    </tr>
    <tr>
        <td>Containerd for Linux</td>
        <td colspan=2>v1.5.7</td>
    </tr>
    <tr>
        <td>CoreDNS</td>
        <td colspan=2>v1.8.4+vmware.4</td>
    </tr>
    <tr>
        <td>CSI Driver for vSphere</td>
        <td>v2.4.0&#42;</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-vSphere-Container-Storage-Plug-in/2.4/rn/vmware-vsphere-container-storage-plugin-24-release-notes/index.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Docker</td>
        <td colspan=2>Linux: v20.10.9<br>Windows: v20.10.7</td>
    </tr>
    <tr>
        <td>etcd</td>
        <td colspan=2>v3.5.0</td>
    </tr>
    <tr>
        <td>Harbor</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1017095">v2.4.1&#42;</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.1">Release Notes</a></td>
    <tr>
        <td>Kubernetes</td>
        <td>v1.22.2</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1221">Release Notes</a></td>
    </tr>
    <tr>
        <td>Metrics Server</td>
        <td colspan=2>v0.5.0</td>
    </tr>
    <tr>
        <td>NCP</td>
        <td>v3.2.0</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3201-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Percona XtraDB Cluster (PXC)</td>
        <td colspan=2>v0.40.0&#42;</td>
    </tr>
    <tr>
        <td>UAA</td>
        <td colspan=2>v74.5.29&#42;</td>
    </tr>
    <tr>
        <td>Velero</td>
        <td><a href="https://customerconnect.vmware.com/downloads/get-download?downloadGroup=VELERO-163">v1.6.3</a></td>
        <td style="text-align: center;"><a href="https://github.com/vmware-tanzu/velero/releases/tag/v1.6.3">Release Notes</a></td>
    </tr>
    <tr>
        <td>Wavefront</td>
        <td colspan=2>Wavefront Collector: v1.7.1&#42;<br>Wavefront Proxy: v10.12&#42;</td>
    </tr>
    <tr>
        <th>Compatibilities</th>
        <th colspan=2>Versions</th>
    </tr>
    <tr>
        <td>Ops Manager</td>
        <td colspan=2>v2.10.24, v2.10.25, v2.10.26, and v2.10.29 and later versions. 
            For more information, see <a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/1017574"><%= vars.product_network %></a> 
            or the <a href="https://docs.pivotal.io/ops-manager/2-10/release-notes.html">Ops Manager Release Notes</a>.
        </td>
    </tr>
    <tr>
        <td>NSX-T</td>
        <td rowspan=2 colspan=2>See <a href="https://interopmatrix.vmware.com/Interoperability?col=644,6783&row=0,">VMware Product Interoperability Matrices&#42;&#42;</a>.</td></td>
        <%# All versions link: https://interopmatrix.vmware.com/Interoperability?col=644&row=0, #%>
    </tr>
    <tr>
        <td>vSphere</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.44 and later&#42;&#42;&#42;</td>
    </tr>
    <tr>
        <td>Xenial stemcells</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/1017574"><%= vars.product_network %></a>.</td>
    </tr>
</table>

<a id="1-13-1-component-updates"></a>&#42; Components marked with an asterisk have been updated.  
&#42;&#42; To use Policy API features, you must use NSX-T v3.1.3.  
&#42;&#42;&#42; See [Deployments Fail on <%= vars.k8s_runtime_abbr %> Windows Worker-based Kubernetes Clusters after the January 2022 Microsoft Windows Security Patch](#1-13-0-stemcell-tar-support).  

### <a id='1-13-1-upgrade'></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> v1.13.1 are from 
<%= vars.k8s_runtime_abbr %> v1.13.0, and from
<%= vars.k8s_runtime_abbr %> v1.12.3 and earlier <%= vars.k8s_runtime_abbr %> v1.12 patches.  


### <a id="1-13-1-features"></a><a id="1-13-1-enhancements"></a><a id="1-13-1-bug-fixes"></a>Resolved Issues
<%= vars.k8s_runtime_abbr %> v1.13.1 has the following resolved issues:

* Fixes the following CVEs:
  * Apache Log4j vulnerability [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228).  
  * Apache Log4j vulnerability [CVE-2021-45046](https://nvd.nist.gov/vuln/detail/CVE-2021-45046).  


<%#* Fixes [The < %= vars.control_plane % > FQDN Must Not Include Trailing Whitespace](https://docs.pivotal.io/tkgi/1-11/release-notes.html#1-11-0-whitespace-pksapi).  
* Fixes [](https://docs.pivotal.io/tkgi/1-12/release-notes.html#). 
 #%>

### <a id="1-13-1-deprecations"></a><a id="1-13-1-upcoming-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Upcoming Deprecations](#1-13-0-upcoming-deprecations) in the
<%= vars.k8s_runtime_abbr %> v1.13.0 Release Notes below.

###<a id='1-13-1-known-issues'></a>Known Issues

Except where noted, the known issues in <%= vars.product_short %> v1.13.0
are also in <%= vars.product_short %> v1.13.1.
See the <%= vars.k8s_runtime_abbr %> v1.13.0 [Known Issues](#1-13-0-known-issues) below.

<p class="note warning"><strong>Warning:</strong> The etcd maintainers do not recommend using etcd v3.5.0 for production environments due to a data corruption that might occur under heavy loads. 
For more information, see <a href="#1-13-0-etcd-3-5-0-data-corruption">etcd v3.5.0 Data Corruption Under Heavy Loads</a> in <i>Known Issues</i> below.  
</p> 


<p class="note warning"><strong>Warning:</strong> Spring MVC and Spring WebFlux JDK 9+ applications running on Tomcat 
as a WAR deployment are vulnerable to remote code execution via data binding. 
For more information, see <a href="#1-13-0-cve-2022-22965">Spring Application Remote Code Execution Vulnerability CVE-2022-22965</a>.
</p> 

<%#
<p class="note warning"><strong>Warning:</strong> If you deploy 
    <  %= vars.k8s_runtime_abbr %  > on vSphere with NSX-T 
and your load balancer ingress rules include both domain and subdomain ingress rules, 
<  %= vars.recommended_by %  > recommends that you upgrade to 
<  %= vars.k8s_runtime_abbr %  > v1.13.2 or later. 
For more information, see <a href="#1-13-0-ncp-k8s-122">Existing NSX-T Load Balancer Domain Ingress Rules Override Newer Subdomain Ingress Rules</a> below.  
</p> 
#%>

For Known Issues in NCP v3.2.0.1, see
[NSX Container Plugin 3.2.0.1 Release Notes](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3201-Release-Notes.html).

<p class="note warning"><strong>Warning:</strong> VMware recommends that you take steps to mitigate
the Apache Log4j vulnerabilities <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228">CVE-2021-44228</a> and <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-45046">CVE-2021-45046</a> as soon as possible. 
For more information, see <a href="#1-13-0-log4j-cve-2021-44228">Apache Log4j Vulnerabilities CVE-2021-44228 and CVE-2021-45046</a> below.
</p>


<hr>

#### <a id="1-13-1-harbor-241"></a> Harbor Private Projects Are Inaccessible after Upgrading to <%= vars.k8s_runtime_abbr %> v1.13.1

If LDAP is enabled, Harbor private projects are inaccessible after upgrading to <%= vars.k8s_runtime_abbr %> v1.13.1.
For more information, see [Private projects become inaccessible after upgrading Harbor for TKGI to v2.4.x with LDAP feature enabled](https://community.pivotal.io/s/article/After-upgrading-Harbor-tile-to-v2-4-x-with-LDAP-feature-enabled-private-projects-turn-unaccessible?language=en_US) 
in the VMware Tanzu Knowledge Base.  


<hr>


## <a id="management-console-1-13-1"></a> <%= vars.k8s_runtime_abbr %> Management Console v1.13.1

**Release Date**: December 22, 2021

<p class="note"><strong>Note</strong>: <%= vars.product_short %> Management Console provides an opinionated
    installation of <%= vars.k8s_runtime_abbr %>. The supported versions may differ from or be more limited than
    what is generally supported by <%= vars.k8s_runtime_abbr %>.
</p>

### <a id="management-console-1-13-1-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Element</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2><a href="https://customerconnect.vmware.com/downloads/details?downloadGroup=TKGIMC-1130&productId=1231">v1.13.1</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>December 22, 2021</td>
    </tr>
    <tr>
        <td>Installed <%= vars.k8s_runtime_abbr %> version</td>
        <td colspan=2><a href="#1-13-1">v1.13.1</a></td>
    </tr>
    <tr>
        <td>Installed Ops Manager version</td>
        <td>v2.10.24</td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/ops-manager/2-10/release-notes.html#2-10-24">Release Notes</a></td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Installed Kubernetes version</td>
        <td>v1.22.2</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1222">Release Notes</a></td>
    </tr>
    <tr>
        <td>Installed Harbor Registry version</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/1017095">v2.4.1&#42;</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.1">Release Notes</a></td>
    </tr>
    <tr>
        <td>Linux stemcell</td>
        <td colspan=2>v621.183&#42;</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.42&#42; and later</td>
    </tr>
</table>
<a id="management-console-1-13-1-component-updates"></a>&#42; Components marked with an asterisk have been updated.

### <a id='management-console-1-13-1-upgrade'></a>Upgrade Path

The supported upgrade paths to <%= vars.product_short %> Management Console v1.13.1 are from 
<%= vars.k8s_runtime_abbr %> MC v1.13.0, and from
<%= vars.k8s_runtime_abbr %> MC v1.12.3 and earlier <%= vars.k8s_runtime_abbr %> MC v1.12 patches.

### <a id="management-console-1-13-1-features"></a>Features and Resolved Issues

<%= vars.k8s_runtime_abbr %> Management Console v1.13.1 has the following resolved issues:

* Fixes [<%= vars.k8s_runtime_abbr %> MC Does Not Support Single-Edge Node Configurations in Automated NAT Mode](#management-console-1-13-0-single-edge-node-auto-nat-mode).  
* Fixes [<%= vars.k8s_runtime_abbr %> MC Does Not Support Multi-Data Center Environments](#management-console-1-13-0-multi-data-center).  

<%#
This release of the TKGI Management Console includes no new features or resolved issues.
< %= vars.k8s_runtime_abbr % > Management Console v1.13.1 has the following features and enhancements:

< %= vars.k8s_runtime_abbr % > Management Console v1.13.1 has the following resolved issues:
 #%>

### <a id="management-console-1-13-1-deprecations"></a> Deprecations

For information about upcoming deprecations, see [Deprecations](#management-console-1-13-0-deprecations) in the
<%= vars.k8s_runtime_abbr %> MC v1.13.0 Release Notes below.

### <a id="management-console-1-13-1-known-issues"></a> Known Issues

Except where noted, the known issues in <%= vars.product_short %> Management Console v1.13.0
are also in <%= vars.product_short %> Management Console v1.13.1.
See the <%= vars.k8s_runtime_abbr %> MC v1.13.0 [Known Issues](#management-console-1-13-0-known-issues) below.

<hr>


## <a id="1-13-0"></a><%= vars.k8s_runtime_abbr %> v1.13.0

**Release Date**: November 30, 2021

<p class="note warning"><strong>Warning:</strong> The etcd maintainers do not recommend using etcd v3.5.0 for production environments due to a data corruption that might occur under heavy loads. 
For more information, see <a href="#1-13-0-etcd-3-5-0-data-corruption">etcd v3.5.0 Data Corruption Under Heavy Loads</a> in <i>Known Issues</i> below.  
</p> 

<p class="note warning"><strong>Warning:</strong> Spring MVC and Spring WebFlux JDK 9+ applications running on Tomcat 
as a WAR deployment are vulnerable to remote code execution via data binding. 
For more information, see <a href="#1-13-0-cve-2022-22965">Spring Application Remote Code Execution Vulnerability CVE-2022-22965</a>.
</p> 
<%#
<p class="note warning"><strong>Warning:</strong> If you deploy 
    <  %= vars.k8s_runtime_abbr %  > on vSphere with NSX-T 
and your load balancer ingress rules include both domain and subdomain ingress rules, 
<  %= vars.recommended_by %  > recommends that you upgrade to 
<  %= vars.k8s_runtime_abbr %  > v1.13.2 or later. 
For more information, see <a href="#1-13-0-ncp-k8s-122">Existing NSX-T Load Balancer Domain Ingress Rules Override Newer Subdomain Ingress Rules</a> below.  
</p> 
#%>

### <a id='1-13-0-snapshot'></a><a id='product-snapshot'></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Release</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2>v1.13.0</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>November 30, 2021</td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Antrea</td>
        <td>v1.3.0-1.2.2&#42;</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-Container-Networking-with-Antrea/1.3/rn/VMware-Container-Networking-with-Antrea-Version-130-122-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>cAdvisor</td>
        <td colspan=2>v0.39.1</td>
    </tr>
    <tr>
        <td>Containerd for Linux</td>
        <td colspan=2>v1.5.7&#42;</td>
    </tr>
    <tr>
        <td>CoreDNS</td>
        <td colspan=2>v1.8.4+vmware.4&#42;</td>
    </tr>
    <tr>
        <td>CSI Driver for vSphere</td>
        <td>v2.4.0&#42;</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-vSphere-Container-Storage-Plug-in/2.4/rn/vmware-vsphere-container-storage-plugin-24-release-notes/index.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Docker</td>
        <td colspan=2>Linux: v20.10.9&#42;<br>Windows: v20.10.7</td>
    </tr>
    <tr>
        <td>etcd</td>
        <td colspan=2>v3.5.0&#42;</td>
    </tr>
    <tr>
        <td>Harbor</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/997034">v2.4.0&#42;</a></td></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.0">Release Notes</a></td>
    </tr>
    <tr>
        <td>Kubernetes</td>
        <td>v1.22.2&#42;</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1221">Release Notes</a></td>
    </tr>
    <tr>
        <td>Metrics Server</td>
        <td colspan=2>v0.5.0&#42;</td>
    </tr>
    <tr>
        <td>NCP</td>
        <td>v3.2.0&#42;</td>
        <td style="text-align: center;"><a href="https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3201-Release-Notes.html">Release Notes</a></td>
    </tr>
    <tr>
        <td>Percona XtraDB Cluster (PXC)</td>
        <td colspan=2>v0.39.0</td>
    </tr>
    <tr>
        <td>UAA</td>
        <td colspan=2>v74.5.26&#42;</td>
    </tr>
    <tr>
        <td>Velero</td>
        <td><a href="https://customerconnect.vmware.com/downloads/get-download?downloadGroup=VELERO-163">v1.6.3</a></td>
        <td style="text-align: center;"><a href="https://github.com/vmware-tanzu/velero/releases/tag/v1.6.3">Release Notes</a></td>
    </tr>
    <tr>
        <td>Wavefront</td>
        <td colspan=2>Wavefront Collector: v1.7.1&#42;<br>Wavefront Proxy: v10.7</td>
    </tr>
    <tr>
        <th>Compatibilities</th>
        <th colspan=2>Versions</th>
    </tr>
    <tr>
        <td>Ops Manager</td>
        <td colspan=2>v2.10.24, v2.10.25, v2.10.26, and v2.10.29 and later versions. 
            For more information, see <a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/999485"><%= vars.product_network %></a> 
            or the <a href="https://docs.pivotal.io/ops-manager/2-10/release-notes.html">Ops Manager Release Notes</a>.
        </td>
    </tr>
    <tr>
        <td>NSX-T</td>
        <td rowspan=2 colspan=2>See <a href="https://interopmatrix.vmware.com/Interoperability?col=644,6204&row=0,">VMware Product Interoperability Matrices&#42;&#42;</a>.</td></td>
        <%# All versions link: https://interopmatrix.vmware.com/Interoperability?col=644&row=0, #%>
    </tr>
    <tr>
        <td>vSphere</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.44 and later&#42;&#42;&#42;</td>
    </tr>
    <tr>
        <td>Xenial stemcells</td>
        <td colspan=2>See <a href="https://network.pivotal.io/products/pivotal-container-service/#/releases/999485"><%= vars.product_network %></a>.</td>
    </tr>
</table>

<a id="1-13-0-component-updates"></a>&#42; Components marked with an asterisk have been updated.  
&#42;&#42; To use Policy API features, you must use NSX-T v3.1.3.  
&#42;&#42;&#42; See [Deployments Fail on <%= vars.k8s_runtime_abbr %> Windows Worker-based Kubernetes Clusters after the January 2022 Microsoft Windows Security Patch](#1-13-0-stemcell-tar-support).  


### <a id='1-13-0-upgrade'></a>Upgrade Path

The supported upgrade paths to <%= vars.k8s_runtime_abbr %> v1.13.0 are from <%= vars.product_short %> v1.12.1 and earlier.

### <a id="1-13-0-breaking-changes"></a>Breaking Changes

<%= vars.k8s_runtime_abbr %> v1.13.0 has the following breaking changes:

* Kubernetes has been upgraded to Kubernetes v1.22:  
<br>
    With Kubernetes v1.22, several deprecated API versions are no longer served. Notable removed API versions include:
    * `admissionregistration.k8s.io/v1beta1` for Webhook resources.  
    * `apiextensions.k8s.io/v1beta1`  for CustomResourceDefinition.  
    * `certificates.k8s.io/v1beta1`  for CertificateSigningRequest.  
    * `extensions/v1beta1` and `networking.k8s.io/v1beta1` for Ingress.  
   
    For more information about the features and deprecations in Kubernetes 1.22, see
    [Kubernetes API and Feature Removals In 1.22: Here's What You Need To Know](https://kubernetes.io/blog/2021/07/14/upcoming-changes-in-kubernetes-1-22/),
    [Deprecated API Migration Guide: 1.22](https://kubernetes.io/docs/reference/using-api/deprecation-guide/#v1-22) or
    [Kubernetes 1.22: Reaching New Peaks](https://kubernetes.io/blog/2021/08/04/kubernetes-1-22-release-announcement/)
    in the Kubernetes documentation.  
<br>     
 
* Telegraf has been upgraded to Telegraf v1.20.2 for host monitoring:  
<br>
    Previous versions of <%= vars.k8s_runtime_abbr %> have used Telegraf v1.12.3 for host monitoring. 
    For information on the differences between the Telegraf v1.12.3 and v1.20.2 releases,
    see [Telegraf 1.20 release notes](https://docs.influxdata.com/telegraf/v1.20/about_the_project/release-notes-changelog/)
    and the release notes for earlier Telegraf versions in the Telegraf documentation.  
    
    <p class="note"><strong>Note:</strong> Cluster monitoring continues to use Telegraf v1.13.2.
    </p>
<br>

* The Telegraf Prometheus Input Plugin is now configured with `metric_version=2`:  
<br>
    In <%= vars.k8s_runtime_abbr %> v1.13.0 the Telegraf Prometheus Input plugin is configured with `metric_version=2`. 
    If you use the Prometheus Output plugin, your Prometheus Client must also be configured with `metric_version=2`. 
    For Telegraf Prometheus Output plugin configuration information, 
    see [Configuration](https://github.com/influxdata/telegraf/tree/release-1.20/plugins/outputs/prometheus_client#configuration) 
    in the Telegraf GitHub repository.  
<br>

* <%= vars.k8s_runtime_abbr %> uses a new `sink-resources` image path:  
<br>
    With <%= vars.k8s_runtime_abbr %> v1.13.0 the `sink-resources` image path has changed from 
    `gcr.io/cf-pks-releng-environments/oratos/` to 
    `cnabu-docker-local.artifactory.eng.vmware.com/oratos/`.  
<br>



### <a id="1-13-0-features"></a><a id="1-13-0-enhancements"></a>Features

<%= vars.k8s_runtime_abbr %> v1.13.0 has the following features and enhancements:  
<%#
#### <a id="1-13-0-policy-api"></a>Supports NSX-T Policy API

Supports NSX-T Policy API for new installations.
See [Considerations for Using the NSX-T Policy API with TKGI](./nsxt-policy-api-considerations.html) and
[Networking](./installing-nsx-t.html#networking) in _Installing Tanzu Kubernetes Grid Integrated Edition on vSphere with NSX-T_. 

#### <a id="1-13-0-enhancements"></a>Additional Features
< %= vars.k8s_runtime_abbr % > v1.13.0 includes the following additional features: 
#%>

* **[Security Fix]** Component bumps fix the following CVEs: 
    * containerd [CVE-2021-41103](https://nvd.nist.gov/vuln/detail/CVE-2021-41103): Unprivileged Linux users can traverse directory contents and execute programs.

* **[Security Feature]** Passes additional CIS Kubernetes Benchmarks: 
    * **1.2.23**: Ensure that the `--audit-log-maxage` is set as appropriate. 
    * **1.2.24**: Ensure that the `--audit-log-maxbackup` is set as appropriate. 
    * **1.2.25**: Ensure that the `--audit-log-maxsize` is set as appropriate. 
   
    For more information, see [CIS Kubernetes Benchmarks](./security.html#benchmarks). 
* The Network Policy `NodePortLocal`, `NetworkPolicyStats`, and `FlowExporter` configurations default to `TRUE`
when using the Antrea CNI. 


### <a id="1-13-0-bug-fixes"></a>Resolved Issues
<%= vars.k8s_runtime_abbr %> v1.13.0 has the following resolved issues:

* Fixes [Creating a New Cluster Fails With the Error 'IP Is Already Allocated'](https://docs.pivotal.io/tkgi/1-12/release-notes.html#1-12-0-create-cluster-ip-already-allocated). 
* Fixes [The <%= vars.k8s_runtime_abbr %> CLI is Unable to Run Simultaneous Commands](https://docs.pivotal.io/tkgi/1-12/release-notes.html#1-12-0-blocking-simultaneous-commands). 
<%#* Fixes [The < %= vars.control_plane % > FQDN Must Not Include Trailing Whitespace](https://docs.pivotal.io/tkgi/1-11/release-notes.html#1-11-0-whitespace-pksapi). #%>
* Fixes infrequent occurrences of `error: kubectl: unbound variable` while creating multiple clusters simultaneously.
* Fixes [`tkgi clusters` Returns the Incorrect Number of Worker Instances](https://docs.pivotal.io/tkgi/1-12/release-notes.html#1-12-0-incorrect-worker-count).  

<%#
* Fixes [](https://docs.pivotal.io/tkgi/1-12/release-notes.html#). 
 #%>

### <a id="1-13-0-deprecations"></a><a id="1-13-0-upcoming-deprecations"></a> Deprecations

The following <%= vars.k8s_runtime_abbr %> features have been deprecated or removed from <%= vars.k8s_runtime_abbr %> v1.13:

* **Manual vSphere CSI Driver Installation Support**: Support for manually installing the vSphere CSI Driver
has been deprecated and support will be entirely removed in <%= vars.k8s_runtime_abbr %> v1.14.
For information on automatic vSphere CSI Driver installation, see
[Deploying and Managing Cloud Native Storage (CNS) on vSphere](vsphere-cns.html).  

<%#* Support for `` has been removed and can no longer be configured in the < %= vars.k8s_runtime_abbr % > tile.

#### <a id="1-13-0-upcoming-deprecations"></a> Upcoming Deprecations

The following < %= vars.k8s_runtime_abbr % > features will be deprecated or removed in future versions of < %= vars.k8s_runtime_abbr % >: 
#%>
* **Flannel Support**: Support for the Flannel Container Networking Interface (CNI) is deprecated.
VMware recommends that you upgrade your Flannel CNI-configured clusters to the Antrea CNI.
For more information about Flannel CNI deprecation, see
[About Upgrading from the Flannel CNI to the Antrea CNI](understanding-upgrades.html#cni)
in _About Tanzu Kubernetes Grid Integrated Edition Upgrades_.

* **Docker Support**: kubelet support for Docker images has been deprecated and Docker support will
be entirely removed in Kubernetes v1.24. <%= vars.k8s_runtime_abbr %> v1.12 and later support containerd images. 

* **VCP Volume Support**: VCP volume support has been deprecated. 
VCP volume support will be entirely removed in <%= vars.k8s_runtime_abbr %> v1.15. 
For information on how to manually migrate VCP volumes on existing <%= vars.k8s_runtime_abbr %> clusters from VCP 
to the automatically installed vSphere CSI Driver, see 
[Migrate from VCP to the vSphere CSI Driver](vsphere-cns.html#migrate-to-csi) in _Deploying and Managing Cloud Native Storage (CNS) on vSphere_.  

* **Pod Security Policy Support**: Kubernetes Pod Security Policy (PSP) support has been deprecated and PSP support will be entirely removed in Kubernetes v1.25.
Kubernetes v1.23 and v1.24 provide beta support for Pod Security Admission.
For more information, see [Pod Security Admission](https://kubernetes.io/docs/concepts/security/pod-security-admission/) and
[Enforce Pod Security Standards with Namespace Labels](https://kubernetes.io/docs/tasks/configure-pod-container/enforce-standards-namespace-labels/)
in the Kubernetes documentation.

<%#
* **Management API**: Management API will be deprecated and later replaced with Policy API in future <%= vars.k8s_runtime_abbr %
> versions. VMware does not recommend that you use Management API
in future <%= vars.k8s_runtime_abbr %
> versions. 
#%>

###<a id='1-13-0-known-issues'></a>Known Issues

<%= vars.k8s_runtime_abbr %> v1.13.0 has the following known issues.  

<p class="note warning"><strong>Warning:</strong> The etcd maintainers do not recommend using etcd v3.5.0 for production environments due to a data corruption that might occur under heavy loads. 
For more information, see <a href="#1-13-0-etcd-3-5-0-data-corruption">etcd v3.5.0 Data Corruption Under Heavy Loads</a> in <i>Known Issues</i> below.
</p> 

<p class="note warning"><strong>Warning:</strong> Spring MVC and Spring WebFlux JDK 9+ applications running on Tomcat 
as a WAR deployment are vulnerable to remote code execution via data binding. 
For more information, see <a href="#1-13-0-cve-2022-22965">Spring Application Remote Code Execution Vulnerability CVE-2022-22965</a>.
</p> 
<%#
<p class="note warning"><strong>Warning:</strong> If you deploy 
    <  %= vars.k8s_runtime_abbr %  > on vSphere with NSX-T 
and your load balancer ingress rules include both domain and subdomain ingress rules, 
<  %= vars.recommended_by %  > recommends that you upgrade to 
<  %= vars.k8s_runtime_abbr %  > v1.13.2 or later. 
For more information, see <a href="#1-13-0-ncp-k8s-122">Existing NSX-T Load Balancer Domain Ingress Rules Override Newer Subdomain Ingress Rules</a> below.  
</p> 
#%>

For Known Issues in NCP v3.2.0, see
[NSX Container Plugin 3.2.0 Release Notes](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3201-Release-Notes.html).

<p class="note warning"><strong>Warning:</strong> VMware recommends that you take steps to mitigate
the Apache Log4j vulnerabilities <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228">CVE-2021-44228</a> and <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-45046">CVE-2021-45046</a> as soon as possible. 
For more information, see <a href="#1-13-0-log4j-cve-2021-44228">Apache Log4j Vulnerabilities CVE-2021-44228 and CVE-2021-45046</a> below.
</p>


<hr>
#### <a id="1-13-0-cannot-update-dedicated-tier1"></a> <%= vars.k8s_runtime_abbr %> Does Not Support Updating Dedicated Tier 1 Clusters

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.2](#1-13-2-bug-fixes).  

<%= vars.k8s_runtime_abbr %> does not support updating dedicated Tier 1 clusters.
You can use a Network Profile to create a dedicated Tier 1 cluster, but you cannot use
`tkgi update-cluster` to update the cluster afterward.

<hr>

#### <a id="1-13-0-renamed-ops-man"></a> TKGI MC Unable to Manage TKGI after Restoring the TKGI Control Plane from Backup

**Symptom**

After you restore Ops Manager and the <%= vars.control_plane %> VM from backup,
<%= vars.k8s_runtime_abbr %> functions normally, but your <%= vars.k8s_runtime_abbr %> MC tabs
include the following error: "...product 'pivotal-container service' is not deployed...".

**Explanation**

<%= vars.k8s_runtime_abbr %> MC is associated with an Ops Manager with a specific name.
If you rename Ops Manager with a new name while restoring, your <%= vars.k8s_runtime_abbr %> MC
will not recognize the restored Ops Manager and cannot manage it.

<hr>

#### <a id="1-13-0-hyperbus-error"></a> Kubernetes Pods on NSX-T Become Stuck in a Creating State

**Symptom**

The pods in your <%= vars.k8s_runtime_abbr %> Kubernetes clusters on NSX-T become stuck in a
creating state.
The connections between nsx-node-agent and hyperbus repeatedly close, log 
`Couldn't connect to 'tcp://...' (error: 111-Connection refused)`, and have a status of
`COMMUNICATION_ERROR`.

**Explanation**

For information and workaround steps for this Known Issue, see
[Issue 2795268: Connection between nsx-node-agent and hyperbus flips and Kubernetes pod is stuck at creating state](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.1/rn/NSX-Container-Plugin-312-Release-Notes.html#RNA_11559)
in _NSX Container Plugin 3.1.2 Release Notes_ in the VMware documentation.

<hr>

#### <a id="1-13-0-nsxt-302-310"></a> Pods Stop After Upgrading From NSX-T v3.0.2 to v3.1.0 on vSphere 7.0 and 7.0.1

This issue is fixed in [NSX-T v3.0.3](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.0/rn/VMware-NSX-T-Data-Center-303-Release-Notes.html#resolvedissues) 
and [NSX-T v3.1.3](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.1/rn/VMware-NSX-T-Data-Center-313-Release-Notes.html#resolvedissues).  

**Symptom**

Your TKGI-provisioned Pods stop after upgrading from NSX-T v3.0.2 to NSX-T v3.1.0 on vSphere 7.0 and 7.0.1.

**Explanation**

For information, see [Issue 2603550: Some VMs are vMotioned and lose network connectivity during UA nodes upgrade]
(https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.1/rn/VMware-NSX-T-Data-Center-311-Release-Notes.html#2603550) in the _VMware NSX-T Data Center 3.1.1 Release Notes_.

**Workaround**

To avoid the loss of network connectivity during UA node upgrade, ensure DRS is set to manual mode
during your upgrade from NSX-T v3.0.2 to v3.1.0.

If you upgraded to NSX-T v3.1.0 with DRS in automation mode, run the following on the affected
Pods' control plane VMs to restore Pod connectivity:

```
monit restart ncp
```

For more information about upgrading NSX-T v3.0.2 to NSX-T v3.1.0, see
[Upgrade NSX-T Data Center to v3.0 or v3.1](upgrade-nsxt.html#upgrade-nsxt). 

<hr>

#### <a id="1-13-0-azure-apply-changes"></a> Error: Could Not Execute "Apply-Changes" in Azure Environment

**Symptom**

After clicking **Apply Changes** on the <%= vars.k8s_runtime_abbr %> tile in an Azure environment,
you experience an error '_...could not execute "apply-changes"..._' with either of the following descriptions:

* _{"errors":{"base":["undefined method 'location' for nil:NilClass"]}}_
* _FailedError.new("Resource Groups in region '#{location}' do not support Availability Zones"))_

For example:

```
INFO | 2020-09-21 03:46:49 +0000 | Vessel::Workflows::Installer#run | Install product (apply changes)
2020/09/21 03:47:02 could not execute "apply-changes": installation failed to trigger: request failed: unexpected response from /api/v0/installations:
HTTP/1.1 500 Internal Server Error
Transfer-Encoding: chunked
Cache-Control: no-cache, no-store
Connection: keep-alive
Content-Type: application/json; charset=utf-8
Date: Mon, 21 Sep 2020 17:51:50 GMT
Expires: Fri, 01 Jan 1990 00:00:00 GMT
Pragma: no-cache
Referrer-Policy: strict-origin-when-cross-origin
Server: Ops Manager
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-Content-Type-Options: nosniff
X-Download-Options: noopen
X-Frame-Options: SAMEORIGIN
X-Permitted-Cross-Domain-Policies: none
X-Request-Id: f5fc99c1-21a7-45c3-7f39
X-Runtime: 9.905591
X-Xss-Protection: 1; mode=block

44
{"errors":{"base":["undefined method `location' for nil:NilClass"]}}
0
```

**Explanation**

The Azure CPI endpoint used by Ops Manager has been changed and 
your installed version of Ops Manager is not compatible with the new endpoint.

**Workaround**

Run the following Ops Manager CLI command:

```
om --skip-ssl-validation --username USERNAME --password PASSWORD --target https://OPSMAN-API curl --silent --path /api/v0/staged/director/verifiers/install_time/IaasConfigurationVerifier -x PUT -d '{ "enabled": false }'
```

Where:

* `USERNAME` is the account to use to run Ops Manager API commands.
* `PASSWORD` is the password for the account.
* `OPSMAN-API` is the IP address for the Ops Manager API

For more information, see
[Error 'undefined method location' is received when running Apply Change on Azure](https://community.pivotal.io/s/article/undefined-method-location-when-running-Apply-Change-on-Azure?language=en_US) in the VMware Tanzu Knowledge Base.

<hr>

#### <a id="1-13-0-vrops-windows-clusters"></a> VMware vRealize Operations Does Not Support Windows Worker-Based Kubernetes Clusters

VMware vRealize Operations (vROPs) does not support Windows worker-based Kubernetes clusters and
cannot be used to manage <%= vars.k8s_runtime_abbr %>-provisioned Windows workers.

<hr>

#### <a id="1-13-0-wavefront-no-win"></a><%= vars.k8s_runtime_abbr %> Wavefront Requires Manual Installation for Windows Workers

To monitor Windows-based worker node clusters with a Wavefront collector and proxy, you must first install Wavefront on the clusters manually, using Helm.
For instructions, see the [Wavefront](windows-monitoring.html#wavefront) section of the
_Monitoring Windows Worker Clusters and Nodes_ topic.

<hr>
#### <a id="1-13-0-ping"></a>Pinging Windows Worker Kubernetes Clusters Does Not Work

<%= vars.k8s_runtime_abbr %>-provisioned Windows worker-based Kubernetes clusters inherit a Kubernetes limitation that prevents outbound ICMP communication from workers.
As a result, pinging Windows workers does not work.

For information about this limitation, see [Limitations > Networking](https://kubernetes.io/docs/setup/production-environment/windows/intro-windows-in-kubernetes/#networking-1) in the _Windows in Kubernetes_ documentation.

<hr>

#### <a id="1-13-0-windows-velero-limitations"></a> Velero Does Not Support Backing Up Stateful Windows Workloads

You can use Velero to back up stateless <%= vars.k8s_runtime_abbr %>-provisioned Windows workers only.
You cannot use Velero to back up stateful Windows applications.
For more information, see [Velero on Windows](https://velero.io/docs/v1.6/basic-install/#velero-on-windows) in
_Basic Install_ in the Velero documentation.

<hr>

#### <a id="1-13-0-tmc-on-gcp"></a>Tanzu Mission Control Integration Not Supported on GCP

<%= vars.k8s_runtime_abbr %> on Google Cloud Platform (GCP) does not support
Tanzu Mission Control (TMC) integration, which is configured in
the **<%= vars.product_tile %>** tile > the **Tanzu Mission Control** pane.

If you intend to run <%= vars.k8s_runtime_abbr %> on GCP,
skip this pane when configuring the <%= vars.product_tile %> tile.

<hr>

#### <a id="1-13-0-tmc-restic"></a>TMC Data Protection Feature Requires Privileged <%= vars.k8s_runtime_abbr %> Containers
TMC Data Protection feature supports privileged <%= vars.k8s_runtime_abbr %> containers only.
For more information, see [Plans](installing-vsphere.html#plans) in the _Installing TKGI_ topic for your IaaS.

<hr>

#### <a id="1-13-0-profile-no-win-gmsa"></a>Windows Worker Kubernetes Clusters with Group Managed Service Account Do Not Support Compute Profiles

Windows worker-based Kubernetes clusters integrated with group Managed Service Account (gMSA) cannot be managed using compute profiles. 

<hr>
#### <a id="1-13-0-profile-no-win-flannel"></a> Windows Worker Kubernetes Clusters on Flannel Do Not Support Compute Profiles

On vSphere with NSX-T networking you can use compute profiles with both Linux and Windows worker&#8209;based Kubernetes clusters.
On vSphere with Flannel networking, you can apply compute profiles only to Linux clusters.

<hr>

#### <a id="1-13-0-profile-resize-down"></a>TKGI CLI Does Not Prevent Reducing the Control Plane Node Count

TKGI CLI does not prevent accidentally reducing a cluster's control plane node count using a compute profile.

<p class="note warning"><strong>Warning:</strong>
    Reducing a cluster's control plane node count can destroy the cluster.
    Do not scale out or scale in existing control plane nodes by reconfiguring the TKGI tile or by using a compute profile.
    Reducing a cluster's number of control plane nodes may remove a control plane node and cause the cluster to become inactive.
</p>

<hr>

#### <a id="1-13-0-in-windows-notready-nodes"></a> Windows Cluster Nodes Not Deleted After VM Deleted

**Symptom**

After you delete a VM using the management console of your infrastructure provider, you notice a Windows worker node
that had been on that VM is now in a `notReady` state.

**Solution**

1. To identify the leftover node:

    ```
    kubectl get no -o wide
    ```
1. Locate nodes on the returned list that are in a `notReady` state and have the same IP address as another node in the list.
1. To manually delete a `notReady` node:

    ```
    kubectl delete node NODE-NAME
    ```
    Where `NODE-NAME` is the name of the node in the `notReady` state.

<hr>

#### <a id="1-13-0-oidc-response-header"></a>502 Bad Gateway After OIDC Login

**Symptom**

You experience a "502 Bad Gateway" error from the NSX load balancer after you log in to OIDC.

**Explanation**

A large response header has exceeded your NSX-T load balancer maximum
response header size. The default maximum response header size is 10,240 characters and should
be resized to 50,000.

**Workaround**

If you experience this issue, manually reconfigure your NSX-T `request_header_size`
and `response_header_size` to 50,000 characters.
For information about configuring NSX-T default header sizes,
see [OIDC Response Header Overflow](https://community.pivotal.io/s/article/OIDC-Response-Header-overflow) in the Knowledge Base.

<hr>

#### <a id="1-13-0-windows-proxy"></a> Difficulty Changing Proxy for Windows Workers

You must configure a global proxy in the <%= vars.product_tile %> tile > **Networking** pane before you create any Windows workers that use the proxy.

You cannot change the proxy configuration for Windows workers in an existing cluster.

<hr>

#### <a id="1-13-0-http-proxy-password"></a> Character Limitations in HTTP Proxy Password

For vSphere with NSX-T, the HTTP Proxy password field does not support the following special characters: `&` or `;`.

<hr>

#### <a id="1-13-0-harbor-storage-config"></a> Error After Modifying Your Harbor Storage Configuration

**Symptom**

You receive the following error after modifying your existing Harbor installation's storage configuration:

```
Error response from daemon: manifest for ... not found: manifest unknown: manifest unknown
```

**Explanation**

Harbor does not support modifying an existing Harbor installation's storage configuration.

**Workaround**

To modify your Harbor storage configuration,
re-install Harbor. Before starting Harbor, configure the new Harbor installation with the desired configuration.

<hr>

#### <a id="1-13-0-resizing-worker-nodes"></a> Ingress Controller Statefulset Fails to Start After Resizing Worker Nodes

**Symptom** 

Permissions are removed from your cluster's files and processes after resizing the persistent disk
during a cluster upgrade. The ingress controller statefulset fails to start.

**Explanation** 

When resizing a persistent disk, Bosh migrates the data from the old disk to the new disk but
does not copy the files' extended attributes.

**Workaround** 

To resolve the problem, complete the steps in
[Ingress controller statefulset fails to start after resize of worker nodes with permission denied]
(https://community.pivotal.io/s/article/5000e00001nCJxT1603094435795?language=en_US)
in the VMware Tanzu Knowledge Base.

<hr>

#### <a id="1-13-0-security-group"></a>Azure Default Security Group Is Not Automatically Assigned to Cluster VMs

**Symptom**

You experience issues when configuring a load balancer for a multi-control plane node Kubernetes cluster or creating a service of type `LoadBalancer`.
Additionally, in the Azure portal, the **VM** > **Networking** page does not display
any inbound and outbound traffic rules for your cluster VMs.

**Explanation**

As part of configuring the <%= vars.product_tile %> tile for Azure, you enter **Default Security Group** in the **Kubernetes Cloud Provider** pane.
When you create a Kubernetes cluster, <%= vars.product_short %> automatically assigns this security group to each VM in the cluster.
However, on Azure the automatic assignment may not occur.

As a result, your inbound and outbound traffic rules defined in the security group are not applied to the cluster VMs.

**Workaround**

If you experience this issue, manually assign the default security group to each VM NIC in your cluster.

<hr>

#### <a id="1-13-0-uuid-length"></a> One Plan ID Longer than Other Plan IDs

**Symptom**

One of your plan IDs is one character longer than your other plan IDs.

**Explanation**

In <%= vars.k8s_runtime_abbr %>, each plan has a unique plan ID.
A plan ID is normally a UUID consisting of 32 alphanumeric characters and 4 hyphens.
However, the **Plan 4** ID consists of 33 alphanumeric characters and 4 hyphens.

**Solution**

You can safely configure and use **Plan 4**.
The length of the **Plan 4** ID does not affect the functionality of **Plan 4** clusters.

If you require all plan IDs to have identical length, do not activate or use **Plan 4**.

<hr>

#### <a id="1-13-0-db-down-after-vm-stopped"></a> Database Cluster Stops After a Database Instance is Stopped

**Symptom**

After you stop one instance in a multiple-instance database cluster, the cluster stops,
or communication between the remaining databases times out, and the entire cluster becomes unreachable.

The following might be in your UAA log:

```
WSREP has not yet prepared node for application use
```

**Explanation**

The database cluster is unable to recover automatically because a member is no longer available to reconcile quorum.

<hr>

#### <a id="1-13-0-velero-vsphere-pvs"></a> Velero Back Up Fails for vSphere PVs Attached to Clusters on Kubernetes v1.20 and Later

**Symptom** 

Backing up vSphere persistent volumes using Velero fails and your Velero backup log includes the following error:

```
rpc error: code = Unknown desc = Failed during IsObjectBlocked check: Could not translate selfLink to CRD name
```

**Explanation**

This is a known issue when backing up clusters on Kubernetes v1.20 and later using the
Velero Plugin for vSphere v1.1.0 or earlier. 

**Workaround** 

To resolve the problem, complete the steps in
[Velero backups of vSphere persistent volumes fail on Kubernetes clusters version 1.20 or higher (83314)](https://kb.vmware.com/s/article/83314)
in the VMware Tanzu Knowledge Base.  

<hr>

#### <a id="1-13-0-creating-two-windows-clusters-fails"></a> Creating Two Windows Clusters at the Same Time Fails

**Symptom**

The first time that you try to create two Windows clusters at the same time, the creation of one of
the clusters fails. If you run `pks cluster CLUSTER-NAME` to examine the last action taken on the
cluster, you see the following:

<pre class="terminal">
Last Action: Create
Last Action State: failed
Last Action Description: Instance provisioning failed: There was a problem completing your request.
. . .
operation: create, error-message: Failed to acquire lock
. . .
locking task id is 111, description: 'create deployment'
</pre>

**Explanation**

This is a known issue that occurs the first time that you create two Windows clusters concurrently.

**Workaround**

Recreate the failed cluster. This issue only occurs the first time that you create two Windows
clusters concurrently.


<hr>

#### <a id="1-13-0-delete-cluster-not-stopped"></a> Deleted Clusters are Listed in Cluster Lists

**Symptom**

After running `tkgi delete-cluster` and cluster deletion has completed,
the deleted cluster continues to be listed when running `tkgi clusters`.

**Workaround**

You must manually remove the deleted cluster using a customized version of the ncp_cleanup script.
For more information, see
[Deleting a Tanzu Kubernetes Grid Integrated Edition cluster with "tkgi delete-cluster" stuck "in progress" status](https://community.pivotal.io/s/article/pks-delete-cluster-in-progress-after-the-cluster-has-been-deleted?language=en_US)
in the VMware Tanzu Knowledge Base.

<hr>

#### <a id="1-13-0-errors-after-reinstall"></a> BOSH Director Logs the Error 'Duplicate vm extension name'

**Symptom**

After you uninstall <%= vars.k8s_runtime_abbr %>, then reinstall <%= vars.k8s_runtime_abbr %> in the same environment,
BOSH Director logs errors similar to the following: 

```
.../gems/bosh-director-0.0.0/lib/bosh/director/deployment_plan/cloud_manifest_parser.rb:120:in `parse_vm_extensions': Duplicate vm extension name 'disk_enable_uuid' (Bosh::Director::DeploymentDuplicateVmExtensionName)
```

**Explanation**

The `pivotal-container-service` cloud-config was not removed when you uninstalled the <%= vars.k8s_runtime_abbr %> tile,
and it remained active.
When you reinstalled the <%= vars.k8s_runtime_abbr %> tile, an additional `pivotal-container-service` cloud-config was created,
causing the metrics_server to fall into a crash-loop state. 

**Workaround**

You must manually remove the `pivotal-container-service` cloud-config after removing your <%= vars.k8s_runtime_abbr %> deployment,
including after removing the <%= vars.k8s_runtime_abbr %> tile from Ops Manager. 

For more information, see ["Duplicate vm extension name" error when metrics_server runs on Director VM in Tanzu Kubernetes Grid Integrated Edition](https://community.pivotal.io/s/article/5000e00001oHXvP1631027033087?language=en_US)
in the VMware Tanzu Community Knowledge Base.

<hr>

#### <a id="1-13-0-whitespace-pksapi"></a> The <%= vars.control_plane %> FQDN Must Not Include Trailing Whitespace

**Symptom**

Your <%= vars.k8s_runtime_abbr %> logs include the following error:

```
'uaa'. Errors are:- Error filling in template 'uaa.yml.erb' (line 59: Client redirect-uri is invalid: uaa.clients.pks_cli.redirect-uri Client redirect-uri is invalid: uaa.clients.pks_cluster_client.redirect-uri)
```

**Explanation**

The <%= vars.control_plane %> fully-qualified domain name (FQDN) for your cluster contains leading or trailing whitespace.

**Workaround**

Do not include whitespace in the <%= vars.k8s_runtime_abbr %> tile **API Hostname (FQDN)** field.

<hr>

#### <a id="1-13-0-cannot-backup-with-tmc"></a> TMC Cluster Data Protection Backup Fails After Upgrading <%= vars.k8s_runtime_abbr %>

The TMC Cluster Data Protection Backup fails in <%= vars.k8s_runtime_abbr %> environments upgraded from an earlier version.

**Symptom**

The TMC Cluster Data Protection Backup fails to back up your existing clusters and logs the following error:  

```
error executing custom action (groupResource=customresourcedefinitions.apiextensions.k8s.io, namespace=, name=ncpconfigs.nsx.vmware.com): rpc error: code = Unknown desc = error fetching v1beta1 version of ncpconfigs.nsx.vmware.com: the server could not find the requested resource
```

**Explanation**

Kubernetes v1.22 disallows the `spec.preserveUnknownFields: true` configuration in your existing clusters and the creation of a v1 CustomResourceDefinitions configuration fails.

<hr>

#### <a id="1-13-0-cannot-restore-with-tmc"></a> TMC Cluster Data Protection Restore Fails When Using Antrea CNI

The TMC Cluster Data Protection Restore operation can fail when restoring multiple Antea resources.

**Symptom**

The TMC Cluster Data Protection Restore fails and logs errors that requests to restore the `admission webhook` have been denied.

**Explanation**

Velero has encountered a race condition while operating a resource. 
For more information, see 
[Allow customizing restore order for Kubernetes controllers and their managed resources](https://github.com/vmware-tanzu/velero/issues/4045) 
in the Velero GitHub repository.

<hr>

#### <a id="1-13-0-cvds-with-nvds"></a> <%= vars.k8s_runtime_abbr %> Does Not Support CVDS / NVDS Mixed Environments

<%= vars.k8s_runtime_abbr %> does not support environments where there are multiple matching networks, such as a mixed CVDS/NVDS environment.

**Symptom**

<%= vars.k8s_runtime_abbr %> logs errors similar to the following in an environment with multiple matching networks:

```
LastOperationstatus='failed', description='Instance provisioning failed: 
There was a problem completing your request. Please contact your operations team providing the following information: 
service: p.pks, service-instance-guid: ..., broker-request-id: ..., task-id: ..., operation: create, 
error-message: Unknown CPI error 'Unknown' with message 'undefined method `mob' for <VimSdk::Vim::OpaqueNetwork:' in create_vm' CPI method
```

**Explanation**

<%= vars.k8s_runtime_abbr %> cannot identify which of the matching networks you intend to use and has selected the wrong network.

<hr>

#### <a id="1-13-0-objects-not-deleted-with-cluster"></a> The Tier-1 Gateway and Static Routes for the LoadBalancer CRD Are Not Deleted While Deleting Policy API-Based Clusters 

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.2](#1-13-2-bug-fixes).  

**Symptom**

After successfully deleting a Policy API-based cluster with LoadBalancer CRDs, you notice that the 
cluster's Tier-1 gateway, static routes for the LoadBalancer CRD, and some <%= vars.k8s_runtime_abbr %> NSX-T resources were not deleted, 
and the following error has been logged:    

```
Found errors in the request. Please refer to the related errors for details.

[Routing] Removal of edge cluster from Tier1 logical router is not allowed as multicast is enabled on it.
```

**Workaround**

To work around this issue:  

* If the cluster has not been deleted:
    1. Delete all of the cluster's LoadBalancer CRDs before deleting the cluster.
* If the cluster has already been deleted: 
    1. Upgrade TKGI to TKGI v1.13.2 or later.  
    1. Login to your PKS VM.  
    1. Back up `ncp_cleanup`:  
    
        ```
        cp /var/vcap/jobs/pks-nsx-t-osb-proxy/bin/ncp_cleanup   /var/vcap/jobs/pks-nsx-t-osb-proxy/bin/ncp_cleanup.bak
        ```
    1. Open ` /var/vcap/jobs/pks-nsx-t-osb-proxy/bin/ncp_cleanup` for editing.
    1. Modify the `pks` parameter to `true`:
    
        ```
        --pks=true \
        ``` 

        For example:  
        
        ```
        $pksnsxcli cleanup \
          --api-type="${API_TYPE}" \
          --nsx-manager-host='192.168.111.101' \
          -c $nsx_manager_client_cert_file \
          -k $nsx_manager_client_key_file \
           \
          --nsx-ca-cert-path=$nsx_manager_ca_cert_file \
           \
          --insecure='false' \
          --cluster "$k8s_cluster_name" \
          --t0-router-id="$t0_router_id" \
          --pks=true \
          --read-only=false \
          --force=$force_delete
        ```
    1. Save your edit to `ncp_cleanup`.  
    1. Run `ncp_cleanup`:  
    
        ```
        /var/vcap/jobs/pks-nsx-t-osb-proxy/bin/ncp_cleanup CLUSTER-ID
        ```
        
        Where `CLUSTER-ID` is the cluster's UUID.  
<br>
    1. Restore `ncp_cleanup` to its original state:  
    
        ```
        cp /var/vcap/jobs/pks-nsx-t-osb-proxy/bin/ncp_cleanup.bak   /var/vcap/jobs/pks-nsx-t-osb-proxy/bin/ncp_cleanup
        ```

<hr>

#### <a id="1-13-0-log4j-cve-2021-44228"></a> Apache Log4j Vulnerabilities CVE-2021-44228 and CVE-2021-45046

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.1](#1-13-1-bug-fixes).  

Due to the Apache Log4j vulnerabilities [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228) 
and [CVE-2021-45046](https://nvd.nist.gov/vuln/detail/CVE-2021-45046), 
VMware recommends that you take the following steps as soon as possible:

1. Upgrade to [Ops Manager v2.10.24](https://docs.pivotal.io/ops-manager/2-10/release-notes.html#2-10-24) or later.  
1. Upgrade to [<%= vars.k8s_runtime_abbr %> v1.13.1](#1-13-1) or later.  

    <p class="note"><strong>Note</strong>: When upgrading <%= vars.k8s_runtime_abbr %> to mitigate the Apache Log4j vulnerability
      you must also upgrade all <%= vars.k8s_runtime_abbr %> clusters.
    </p>
    
If you cannot upgrade Ops Manager or <%= vars.k8s_runtime_abbr %>, 
VMware recommends that you implement the workaround steps provided in the VMware Tanzu Knowledge Base:  

* If you cannot upgrade Ops Manager: 
[Instructions to address CVE-2021-44228 in Tanzu Operations Manager](https://community.pivotal.io/s/article/5004y00001mPn2N1639255611105?language=en_US).  
* If you cannot upgrade <%= vars.k8s_runtime_abbr %>: 
[Workaround instructions to address CVE-2021-44228 in Tanzu Kubernetes Grid Integrated](https://community.pivotal.io/s/article/Workaround-instructions-to-address-CVE-2021-44228-in-Tanzu-Kubernetes-Grid-Integrated?language=en_US).  


For more information about the impact of the Log4j [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228) 
and [CVE-2021-45046](https://nvd.nist.gov/vuln/detail/CVE-2021-45046) vulnerabilities on VMware products, 
see [VMSA-2021-0028](https://www.vmware.com/security/advisories/VMSA-2021-0028.html) 
in _Advisories_ in the VMware Security Solutions documentation.  

<hr>

#### <a id="1-13-0-ovsdb-server-failure"></a> Occasionally update-cluster Does Not Complete for Windows Workers

Occasionally, `tkgi update-cluster` hangs while updating a Windows worker node instance and the BOSH task cannot finish and exits.  

**Symptom**

The `ovsdb-server` service has stopped but other processes report that it is running.  

**Explanation**

The `ovsdb-server.pid` file uses the pid for a process that is not the ovsdb-server.

To confirm that this is the root cause for `tkgi update-cluster` to hang:

* To verify the `ovsdb-server` service has actually stopped, run the PowerShell `Get-services` command on the Windows worker node.  
* To verify that other processes report the `ovsdb-server` service is still running:
<br>
    1. Review the ovsdb-server `job-service-wrapper.err.log` log file.  
<br>
        The `job-service-wrapper.err.log` log file is located at:  
        
        ```
        C:\var\vcap\sys\log\openvswitch-windows\ovsdb-server\job-service-wrapper.err.log
        ```
    1. Confirm that after the flushing processes, the log includes an error similar to the following:  

        ```
        Pid-Guard : ovsdb-server is already runing, please stop it first
        At C:\var\vcap\jobs\openvswitch-windows\bin\ovsdb-server_ctl.ps1:30 char:5
        +     Pid-Guard $PIDFILE "ovsdb-server"
        +     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
            + CategoryInfo          : NotSpecified: ( [Write-Error], WriteErrorException
            + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorException,Pid-Guard
        ```
* To verify the root cause:
<br>
    1. Run the following PowerShell commands on the Windows worker node:  
    
        ```
        $RUN_DIR = "C:\var\vcap\sys\run\openvswitch-windows"
        $PIDFILE = "$RUN_DIR\ovsdb-server.pid"
        $pid1 = Get-Content $PidFile -First 1
        echo $pid1
        $rst = Get-Process -Id $pid1 -ErrorAction SilentlyContinue
        echo $rst
        ```
    1. Confirm the returned `ProcessName` is not `ovsdb-server`.
    
**Workaround**

To resolve this issue for a single Windows worker:  

1. SSH to the affected worker node.  
1. Run the following:   

    ```
    rm C:\var\vcap\sys\run\openvswitch-windows\ovsdb-server.pid
    ```
1. Wait for the `ovsdb-server` process to start.  
1. Confirm the dependent services also start.


<hr>

#### <a id="1-13-0-update-remove-pool"></a> Using a New Compute Profile to Add and Remove Node Pools Deletes and Recreates the Node Pool VMs

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.2](#1-13-2-bug-fixes).

When you update a cluster using a Compute Profile to remove existing node pools and create new node pools, 
BOSH deletes the VMs for the existing node pools and creates new VMs instead of renaming the existing VMs and updating them.  

<hr>

#### <a id="1-13-0-1000-objects-error"></a> Rotate-Certificates Returns 'Could Not Fetch VMs Info' When Rotating Certificates for More than 1000 Clusters

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.2](#1-13-2-bug-fixes).

**Symptom**

When you rotate certificates by running the `pks rotate-certificates` CLI command with the `--only-nsx` parameter, 
in an environment with more than one thousand clusters, the command returns the following error:

```
Error: Cluster ... not found.
ERROR 15217  [nio-9021-exec-6] i.pivotal.pks.error.ApiExceptionHandler : Error: Status: 500; 
ErrorMessage: <nil>; Description: There was a problem completing your request. 
    Please contact your operations team providing the following information: 
    ...operation: bind - error-message: gathering binding info Could not fetch VMs info
```

**Workaround**

To rotate the certificates that did not automatically rotate, you must rotate the certificates manually. 
For more information, see [How to rotate Tanzu Kubernetes Grid Integrated Edition tls-nsx-t cluster certificate](https://kb.vmware.com/s/article/80324?lang=en_US) 
in the VMware Tanzu Knowledge Base.
  

<hr>

#### <a id="1-13-0-harbor-241"></a> Harbor Private Projects Are Inaccessible after Upgrading to <%= vars.k8s_runtime_abbr %> v1.13.0

If LDAP is enabled, Harbor private projects are inaccessible after upgrading to <%= vars.k8s_runtime_abbr %> v1.13.0.
For more information, see [Private projects become inaccessible after upgrading Harbor for TKGI to v2.4.x with LDAP feature enabled](https://community.pivotal.io/s/article/After-upgrading-Harbor-tile-to-v2-4-x-with-LDAP-feature-enabled-private-projects-turn-unaccessible?language=en_US) 
in the VMware Tanzu Knowledge Base.  

<hr>

#### <a id="1-13-0-ncp-k8s-122"></a> Existing NSX-T Load Balancer Domain Ingress Rules Override Newer Subdomain Ingress Rules

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.2](#1-13-2-bug-fixes).

On <%= vars.k8s_runtime_abbr %> v1.13 and later, on vSphere with NSX-T, if you apply a load balancer ingress rule to a domain 
before applying ingress rules to subdomains, the domain ingress rule is applied to both the domain and the subdomains, 
and the subdomain ingress rules are ignored.

**Explanation**

With Kubernetes v1.22 and NCP v3.2.0, load balancer ingress rules are applied to domains and subdomains via regex pattern matching 
instead of exact-match pattern matching. 

The load balancer subdomains match the specified domain ingress rule pattern and the subsequent subdomain ingress rules are ignored.  

For more information, see [Resolved Issues](https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.2/rn/NSX-Container-Plugin-3203-Release-Notes.html#resolvedissues) in the NSX Container Plugin 3.2.0.3 Release Notes.  

**Workaround**

For newly created ingress rules, specify subdomain rules before rules for their associated domain. 
For example, specify the rules for `api.example.com` and  `mail.example.com` before the rules for `example.com`.  


<hr>

#### <a id="1-13-0-stemcell-tar-support"></a> Deployments Fail on <%= vars.k8s_runtime_abbr %> Windows Worker-based Kubernetes Clusters after the January 2022 Microsoft Windows Security Patch 

Microsoft changed Microsoft Windows' support for tar file commands in the January 2022 Microsoft Windows security patch.  

Packaging scripts that use tar commands for Windows worker-based Kubernetes Cluster deployments 
can fail after the Microsoft tar command patch update has been applied.  

The BOSH agent used by vSphere stemcells built by stembuild v2019.43 and earlier use tar commands that are no longer supported 
and will fail if the Microsoft Windows security patch has been applied.  


**Workaround**

Stembuild v2019.44 and later include a version of the BOSH agent that does not use unsupported tar commands.  

If you use vSphere stemcells, use Stembuild 2019.44 or later to avoid the BOSH agent tar error.  


<hr>

#### <a id="1-13-0-air-gapped-csi-migration"></a> Cluster Migration to the vSphere CSI Driver Does Not Support Air-Gapped Environments

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.2](#1-13-2-bug-fixes).

**Symptom**

After you enable the vSphere CSI Driver and migrate your clusters from VCP to vSphere CSI Driver, 
the validating webhook isn't able to start and reports errors similar to the following:  

```
Warning Failed: Failed to pull image "gcr.io/cloud-provider-vsphere/csi/release/syncer:v2.4.0": rpc error: code = Unknown desc = Error response from daemon: Get "https://gcr.io/v2/": dial tcp: lookup gcr.io on .... no such host

Warning Failed: Error: ErrImagePull

Warning Failed: ImagePullBackOff
```

**Explanation**

In air-gaped environments, the validating webhook is unable to pull the container image from gcr.io. 


**Workaround**

Your environment must be able to access gcr.io during CSI migration.  


<hr>

#### <a id="1-13-0-multiple-coredns"></a> Multiple CoreDNS Pods Might Run On the Same Worker Node after Upgrading a Cluster

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.2](#1-13-2-bug-fixes).

**Symptom**

After upgrading a <%= vars.k8s_runtime_abbr %> cluster, <%= vars.k8s_runtime_abbr %> might run two CoreDNS Pods on the same worker node. 


<hr>

#### <a id="1-13-0-128-antrea-migration"></a> Cluster Migration from Flannel to Antrea Can Fail for Certain CIDR Addresses

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.3](#1-13-3-bug-fixes).  

Migrating a cluster from Flannel to Antrea fails if the first octet in the cluster's 
CIDR IP address is greater than `128`. For example: `172.0.0.0/17`.

**Symptom**

After your cluster fails to migrate from Flannel to Antrea:

* An error similar to the following is logged in your cluster creation log:  

    ```
    "code":450001,"message":"Action Failed get_task: Task ... result: 1 of 6 post-start scripts failed. 
    Failed Jobs: deploy-antrea. Successful Jobs: bosh-dns, kube-apiserver, kubernetes-roles, etcd, deploy-proxy-agent."
    ```

* And errors similar to the following are logged in your antrea-deploy folder:

    ```
    /var/vcap/jobs/deploy-antrea/bin/post-start: line 45: 2.88676e+09: syntax error: invalid arithmetic operator (error token is ".88676e+09")

    /var/vcap/jobs/deploy-antrea/bin/post-start: line 50: antrea_svc_ip_int: unbound variable
    ```


<hr>

#### <a id="1-13-0-fip-ip-reuse"></a> <%= vars.k8s_runtime_abbr %> Reallocates Network Profile-Allocated FIP Pool Addresses 

**Symptom**

The pre-start script for `tkgi create-cluster` fails and logs floating IP pool allocation errors in the `pre-start.stderr.log` similar to the following:  

```
level=error msg="operation failed with [POST /pools/ip-pools/{pool-id}][409] allocateOrReleaseFromIpPoolConflict  &{RelatedAPIError:{Details: ErrorCode:5141 ErrorData:<nil> ErrorMessage:Requested IP Address ... is already allocated. ModuleName:id-allocation service} RelatedErrors:[]}\n"

level=warning msg="failed to allocate FIP from (pool: ...: [POST /pools/ip-pools/{pool-id}][409] allocateOrReleaseFromIpPoolConflict  &{RelatedAPIError:{Details: ErrorCode:5141 ErrorData:<nil> ErrorMessage:Requested IP Address ... is already allocated. ModuleName:id-allocation service} RelatedErrors:[]}\n"

Error: an error occurred during FIP allocation
```

**Explanation**

<%= vars.k8s_runtime_abbr %> administrators can allocate floating IP pool IP Addresses in a Network Profile configuration. 
The <%= vars.k8s_runtime_abbr %> control plane allocates IP Addresses from the floating IP pool without accounting for the IPs allocated using Network Profiles.  

**Workaround**

<%= vars.k8s_runtime_abbr %> allocates IP addresses starting from the beginning of a floating IP pool range. 
When configuring a Network Profile, allocate IP Addresses starting at the end of the floating IP pool range instead of those at the beginning.  

<hr>

#### <a id="1-13-0-etcd-3-5-0-data-corruption"></a><a id="etcd-3-5-0-data-corruption"></a>  etcd v3.5.0 Data Corruption Under Heavy Loads

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.4](#1-13-4-bug-fixes).  

**Explanation**

The etcd maintainers have announced that etcd v3.5.0 is no longer recommended for production environments due to a data corruption that might occur under heavy loads.   

The corruption might occur silently. <%= vars.recommended_by %> recommends that <%= vars.k8s_runtime_abbr %> v1.13 and later administrators 
configure their clusters to detect if the etcd data corruption occurs.  

If your Kubernetes cluster control plane nodes running etcd do not have memory pressure and sigkill has not been interrupted, 
community analysis indicates that there is a very low possibility of data corruption occurring.  

For more information, see [How to detect etcd inconsistency issues in TKGI 1.13.x which could be affected by a known issue in etcd v3.5.x](https://kb.vmware.com/s/article/88095) 
in the VMware Tanzu Knowledge Base, and 
[Etcd v3.5.0-v3.5.2 is not recommended for production](https://groups.google.com/g/etcd-dev/c/sad9tgmKU7Y) in the etcd-dev blog.  

<hr>

#### <a id="1-13-0-cve-2022-22965"></a> Spring Application Remote Code Execution Vulnerability CVE-2022-22965

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.4](#1-13-4-bug-fixes).  

<%= vars.k8s_runtime_abbr %> v1.13.0 through v1.13.3 deploy a version of UAA affected by CVE-2022-22965, a Spring application exploit.  

<%= vars.recommended_by %> has confirmed that the vulnerability affects applications running in <%= vars.k8s_runtime_abbr %> environments 
and recommends that you implement the workaround steps below as soon as possible.  

**Explanation**

Through the CVE-2022-22965 exploit, Spring MVC and Spring WebFlux JDK 9+ applications running on Tomcat 
as a WAR deployment are vulnerable to remote code execution (RCE) via data binding.  

For information on CVE-2022-22965, see [CVE-2022-22965: Spring Framework RCE via Data Binding on JDK 9+](https://tanzu.vmware.com/security/cve-2022-22965) 
or [VMSA-2022-0010](https://www.vmware.com/security/advisories/VMSA-2022-0010.html) in the _VMware Security Advisories_ documentation.  

**Workaround**

For information on how to manually mitigate CVE-2022-22965 in <%= vars.k8s_runtime_abbr %>, see 
[Workaround instructions to address CVE-2022-22965 in TKGI v1.11 ~ v1.13](https://kb.vmware.com/s/article/88102) in the VMware Tanzu Knowledge Base.  



<hr>

#### <a id="1-13-0-containerd-sock-error"></a> Cluster Upgrading Fails After Upgrading NSX-T and <%= vars.k8s_runtime_abbr %>

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.4](#1-13-4-bug-fixes).  

If you patch upgrade NSX-T and then upgrade <%= vars.k8s_runtime_abbr %>, 
your cluster upgrades will fail for clusters running the Docker container runtime.  


**Symptom**

Errors similar to the following are logged when your Docker container runtime cluster upgrades fail:  

```
worker/...:/var/vcap/sys/log/docker# cat docker.stderr.log
failed to start daemon: failed to dial "/run/containerd/containerd.sock": failed to dial "/run/containerd/containerd.sock": context deadline exceeded
```

**Explanation**

Docker and kubelet are unable to start because the `vrops-cadvisor` DaemonSet has 
detected that the `/run/containerd/containerd.sock` file does not exist and then 
automatically created it.  

**Workaround**

If you have already upgraded NSX-T and <%= vars.k8s_runtime_abbr %>:

1. During cluster upgrading, monitor your worker nodes.  
1. On each worker node:  
    1. Remove `/run/containerd/containerd.sock`.  
    1. Drain and stop all running jobs.  

<br>
If you have not upgraded NSX-T and <%= vars.k8s_runtime_abbr %>:

1. Upgrade <%= vars.k8s_runtime_abbr %> before updating NSX-T.
1. Upgrade clusters using your normal procedures.  


<hr>

#### <a id="1-13-0-cert-rotate-stops"></a> Certificate Rotation Fails If the Cluster Has a Kubernetes Profile 

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.4](#1-13-4-bug-fixes).  

If you run `tkgi rotate-certificates` on a cluster configured with a Kubernetes Profile, 
the certificate rotation process will halt before completing.  


**Symptom**

`tkgi rotate-certificates` halts and logs errors similar to the following when rotating certificates on a cluster configured with a Kubernetes Profile:  

```
org.hibernate.LazyInitializationException: could not initialize proxy io.pivotal.pks.profile.kubernetes.data.KubernetesProfileEntity#... - no Session
at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:169) ~[hibernate-core-5.3.18.Final.jar!/:5.3.18.Final]
at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:309) ~[hibernate-core-5.3.18.Final.jar!/:5.3.18.Final]
```


<hr>

#### <a id="1-13-0-logs-growing"></a> kube-apiserver Logs Occupy More Disk Space than Allocated

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.5](#1-13-5-bug-fixes).

kube-apiserver logs are regularly compressed and stored for future reference.  

Stale kube-apiserver logs should be deleted when the compressed logs occupy their maximum allocated disk space. 
The compressed kube-apiserver logs are instead being re-compressed, renamed, and moved to a different location.  

<hr>

#### <a id="1-13-0-csi-proxy-issue"></a> Automatic vSphere CSI Driver Integration Ignores Proxy Configuration

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.6](#1-13-6-bug-fixes).  

In an environment configured with a proxy, automatic vSphere CSI Driver Integration ignores the configured proxy and fails.  

**Symptom**

In environments configured with a Proxy and automatic **vSphere CSI Driver Integration** enabled, 
the `csi-controller` and `csi-syncer` services log errors similar to the following and fail:  

```
"caller":"vsphere/virtualcenter.go:154","msg":"failed to create new client with err: Post \"...\": dial tcp: lookup ...: no such host"
```

**Workaround**

To configure the vSphere CSI Driver to use your proxy:  

1. SSH to <%= vars.k8s_runtime_abbr %> Control Plane VM.  

1. Open the `/var/vcap/jobs/csi-controller/bin/csi_controller_ctl` configuration file for editing.  

1. Locate the `start_csi_controller` function in the configuration file:  

    ```
    start_csi_controller()
    {
        ...
        export ...
        export ...
        export ...
        ...
    }
    ```
1. Locate the `export` commands in the `start_csi_controller` function 
and add the following to the group of export commands:  

    ```
    export HTTP_PROXY=HTTP-PROXY
    export HTTPS_PROXY=HTTPS-PROXY
    export NO_PROXY=NO-PROXY
    ```
    
    Where:  
    * `HTTP-PROXY` is the HTTP Proxy that the vSphere CSI Driver must use.  
    * `HTTPS-PROXY` is the HTTPS Proxy that the vSphere CSI Driver must use.  
    * `NO-PROXY` is a list of host names that the vSphere CSI Driver should not use a proxy for.  

1. Restart the `csi_controller`:  

    ```
    sudo monit restart csi_controller
    ```

<hr>


#### <a id="1-13-0-vm-extensions-toggle"></a> Custom BOSH vm_extensions Configuration Settings Toggle On and Off

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.6](#1-13-6-bug-fixes).  

After a failed `tkgi upgrade-cluster` run, your custom BOSH vm_extensions configuration toggles between being present and absent 
depending on when you review the cluster manifest.  


**Explanation**

The VMs that were updated by `tkgi update-cluster` before the failure have manifests with the desired BOSH vm_extensions configuration, 
while those updated afterward do not. 
Re-running `tkgi update-cluster` does not update the manifests in the remaining VMs because the cluster configuration has not changed.  


<hr>


#### <a id="1-13-0-antrea-switch-disabled"></a> Switching Your Default CNI to Antrea is Not Supported

<%# This issue is fixed in [< %= vars.k8s_runtime_abbr % > v1.13.6](#1-13-6-bug-fixes). #%>

You cannot switch your default CNI from Flannel to Antrea during <%= vars.k8s_runtime_abbr %> upgrade 
if <%= vars.k8s_runtime_abbr %> is running on Ops Manager v2.10.40 or later.


<hr>


#### <a id="1-13-0-vmdks-deleted-during-migration"></a> VMDKs Are Deleted during Migration from In-Tree Storage to CSI

This issue is fixed in [<%= vars.k8s_runtime_abbr %> v1.13.6](#1-13-6-bug-fixes).  

While migrating a cluster from using the In-Tree vSphere Storage Driver to the automatically installed vSphere CSI Driver, 
VMDKs attached to worker VMs might be deleted.  

For more information, see [vsphere-csi-driver](https://github.com/kubernetes-sigs/vsphere-csi-driver/releases/tag/v2.4.2) 
the vSphere CSI Driver Release Notes in GitHub.  

<hr>


#### <a id="1-13-0-docker-image-not-removed"></a> The Docker Image Remains after Switching to the Containerd Container Runtime

<%# This issue is fixed in [< %= vars.k8s_runtime_abbr % > v1.13.8](#1-13-8-bug-fixes). #%>

The Docker image is not automatically removed after successfully switching a cluster from the Docker container runtime to containerd.  

**Workaround**

To remove a Docker image after switching a cluster's container runtime:  

1. Manually remove the cluster's `/var/vcap/store/docker` directory.  


<hr>



## <a id="management-console-1-13-0"></a> <%= vars.k8s_runtime_abbr %> Management Console v1.13.0

**Release Date**: November 11, 2021

<p class="note"><strong>Note</strong>: <%= vars.product_short %> Management Console provides an opinionated
    installation of <%= vars.k8s_runtime_abbr %>. The supported versions may differ from or be more limited than
    what is generally supported by <%= vars.k8s_runtime_abbr %>.
</p>

### <a id="management-console-1-13-0-snapshot"></a>Product Snapshot

<table class="nice">
    <tr>
        <th>Element</th>
        <th colspan=2>Details</th>
    </tr>
    <tr>
        <td>Version</td>
        <td colspan=2>v1.13.0</td>
    </tr>
    <tr>
        <td>Release date</td>
        <td colspan=2>November 30, 2021</td>
    </tr>
    <tr>
        <td>Installed <%= vars.k8s_runtime_abbr %> version</td>
        <td colspan=2><a href="#1-13-0">v1.13.0&#42;</a></td>
    </tr>
    <tr>
        <td>Installed Ops Manager version</td>
        <td>v2.10.21</td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/ops-manager/2-10/release-notes.html#2-10-21">Release Notes</a></td>
    </tr>
    <tr>
        <th>Component</th>
        <th colspan=2>Version</th>
    </tr>
    <tr>
        <td>Installed Kubernetes version</td>
        <td>v1.22.2&#42;</td>
        <td style="text-align: center;"><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1221">Release Notes</a></td>
    </tr>
    <tr>
        <td>Installed Harbor Registry version</td>
        <td><a href="https://network.pivotal.io/products/harbor-container-registry/#/releases/997034">v2.4.0&#42;</a></td>
        <td style="text-align: center;"><a href="https://docs.pivotal.io/vmware-harbor/release-notes.html#v2.4.0">Release Notes</a></td>
    </tr>
    <tr>
        <td>Linux stemcell</td>
        <td colspan=2>v621.176&#42;</td>
    </tr>
    <tr>
        <td>Windows stemcells</td>
        <td colspan=2>v2019.37 and later</td>
    </tr>
</table>
<a id="management-console-1-13-0-component-updates"></a>&#42; Components marked with an asterisk have been updated.

### <a id='management-console-1-13-0-upgrade'></a>Upgrade Path

The supported upgrade path to <%= vars.product_short %> Management Console v1.13.0 is from
<%= vars.product_short %> v1.12.0 and later. 

### <a id="management-console-1-13-0-features"></a>Features and Resolved Issues

This release of the TKGI Management Console includes no new features or resolved issues.
<%#
< %= vars.k8s_runtime_abbr % > Management Console v1.13.0 has the following features and enhancements:

< %= vars.k8s_runtime_abbr % > Management Console v1.13.0 has the following resolved issues:
#%>

### <a id="management-console-1-13-0-deprecations"></a> Deprecations

The following <%= vars.k8s_runtime_abbr %> features have been deprecated or removed from <%= vars.k8s_runtime_abbr %> Management Console v1.13:

<%#* Support for `` has been removed and can no longer be configured in the < %= vars.k8s_runtime_abbr % > tile. #%>

### <a id="management-console-1-13-0-known-issues"></a> Known Issues

The <%= vars.product_short %> Management Console v1.13.0 has the following known issues:

<hr>
#### <a id="management-console-1-13-0-multi-data-center"></a> <%= vars.k8s_runtime_abbr %> Management Console Does Not Support Multi-Data Center Environments

This issue is fixed in [<%= vars.k8s_runtime_abbr %> MC v1.13.1](#management-console-1-13-1-features).  

You cannot use the <%= vars.k8s_runtime_abbr %> MC to configure or deploy <%= vars.k8s_runtime_abbr %> in an environment with multiple data centers.

<hr>

#### <a id="management-console-1-13-0-vrli-https"></a> vRealize Log Insight Integration Does Not Support HTTPS Connections

**Symptom**

The <%= vars.product_short %> Management Console integration to vRealize Log Insight does not support connections to the HTTPS port on the vRealize Log Insight server.

**Workaround**

1. Use SSH to log in to the <%= vars.product_short %> Management Console appliance VM.
1. Open the file `/lib/systemd/system/pks-loginsight.service` in a text editor.
1. Add `-e LOG_SERVER_ENABLE_SSL_VERIFY=false`.
1. Set `-e LOG_SERVER_USE_SSL=true`.

    The resulting file should look like the following example:

    ```
    ExecStart=/bin/docker run --privileged --restart=always --network=pks
    -v /var/log/journal:/var/log/journal
    --name=pks-loginsight
    -e TYPE=gear2-vm
    -e LOG_SERVER_HOST=${LOGINSIGHT_HOST}
    -e LOG_SERVER_PORT=${LOGINSIGHT_PORT}
    -e LOG_SERVER_ENABLE_SSL_VERIFY=false
    -e LOG_SERVER_USE_SSL=true
    -e LOG_SERVER_AGENT_ID=${LOGINSIGHT_ID}
    pksoctopus/vrli-journald:v07092019
    ```

1. Save the file and run `systemctl daemon-reload`.
1. To restart the vRealize Log Insight service, run `systemctl restart pks-loginsight.service`.

<%= vars.product_short %> Management Console can now send logs to the HTTPS port on the vRealize Log Insight server.

<hr>

#### <a id="management-console-1-13-0-vsphere-ha"></a> vSphere HA causes Management Console ovfenv Data Corruption

**Symptom**

If you enable vSphere HA on a cluster, if the TKGI Management Console appliance VM is running on a
host in that cluster, and if the host reboots, vSphere HA recreates a new TKGI Management Console
appliance VM on another host in the cluster. Due to an issue with vSphere HA, the `ovfenv` data for
the newly created appliance VM is corrupted and the new appliance VM does not boot up with the
correct network configuration.

**Workaround**

1. In the vSphere Client, right-click the appliance VM and select **Power** > **Shut Down Guest OS**.
1. Right-click the appliance again and select Edit Settings.
1. Select **VM Options** and click **OK**.
1. Verify under Recent Tasks that a `Reconfigure virtual machine` task has run on the appliance VM.
1. Power on the appliance VM.

<hr>

#### <a id="management-console-1-13-0-k8s-profile"></a> Base64 encoded file arguments are not decoded in Kubernetes profiles

**Symptom**

Some file arguments in Kubernetes profiles are base64 encoded. When the management console displays
the Kubernetes profile, some file arguments are not decoded.

**Workaround**

Run `echo "$content" | base64 --decode`

<hr>

#### <a id="management-console-1-13-0-network-profile"></a> Network profiles not immediately selectable

**Symptom**

If you create network profiles and then try to apply them in the Create Cluster page, the new
profiles are not available for selection.

**Workaround**

Log out of the management console and log back in again.

<hr>

#### <a id="management-console-1-13-0-cluster-summary"></a> Real-Time IP information not displayed for network profiles

**Symptom**

In the cluster summary page, only default IP pool, pod IP block, node IP block values are displayed,
rather than the real-time values from the associated network profile.

**Workaround**

None

<hr>
#### <a id="management-console-1-13-0-harbor-storage-config"></a> Error After Modifying Your Harbor Storage Configuration

**Symptom**

You receive the following error after modifying your existing Harbor installation's storage configuration:

```
Error response from daemon: manifest for ... not found: manifest unknown: manifest unknown
```

**Explanation**

Harbor does not support modifying an existing Harbor installation's storage configuration.

**Workaround**

To modify your Harbor storage configuration,
re-install Harbor. Before starting Harbor, configure the new Harbor installation with the desired configuration.

<hr>
#### <a id="management-console-1-13-0-re-import-windows-stemcell"></a> Windows Stemcells Must be Re-Imported After Upgrading Ops Manager

**Symptom**

After upgrading Ops Manager, your Management Console does not recognize a Windows stemcell imported
when using the prior version of Ops Manager.

**Workaround**

If your Management Console does not recognize a Windows stemcell after upgrading Ops Manager:

1. Re-import your previously imported Windows stemcell. 
2. **Apply Changes** to <%= vars.k8s_runtime_abbr %> MC. 

<hr>

#### <a id="management-console-1-13-0-cluster-group-name"></a> Your New Clusters Are Not Shown In Tanzu Mission Control

**Symptom**

After you create a cluster, Tanzu Mission Control does not include the cluster in cluster lists.
You have a "_Resource not found_" error similar to the following in your BOSH logs:

```
Cluster Name in TMC: cluster-1
Cluster Name Prefix: tkgi-my-prefix-
Group Name in TMC: my-prefix-clusters
Cluster Description in TMC: VMware Enterprise PKS Attaching cluster ''tkgi-my-prefix-cluster-1'' to TMC
Fetching token successful
request POST:/v1alpha1/clusters,
response 404 Not Found:{"error":"Resource not found - clustergroup(my-prefix-clusters)
org id(d859dc9f-g622-426d-8c91-939a9f13dea9)",
"code":5,"message":"Resource not found - clustergroup(my-prefix-clusters)
```

**Explanation**

The cluster group you assign a cluster to must be defined in Tanzu Mission Control
before you assign your cluster to the cluster group in the <%= vars.k8s_runtime_abbr %> Management Console.

**Workaround** 

To resolve the problem, complete the steps in
[Attaching a Tanzu Kubernetes Grid Integrated (TKGI) cluster to Tanzu Mission Control (TMC) fails with "Resource not found - clustergroup(cluster-group-name)"](https://community.pivotal.io/s/article/tkgi-tmc-attach-fail)
in the VMware Tanzu Knowledge Base.  

<hr>

#### <a id="management-console-1-13-0-single-edge-node-auto-nat-mode"></a> <%= vars.k8s_runtime_abbr %> MC Does Not Support Single-Edge Node Configurations in Automated NAT Mode

This issue is fixed in [<%= vars.k8s_runtime_abbr %> MC v1.13.1](#management-console-1-13-1-features).  

**Symptom**

The <%= vars.k8s_runtime_abbr %> Configuration view within <%= vars.k8s_runtime_abbr %> MC displays the following error:

```
Fail to configure NSX for TKGI: Traceback (most recent call last): File"scripts/nsx_automoaror.py", line 182, 
in <module> edgee_tzs |= extra_edge2_tzs TpeError: unsupported operand type(s) for |=:'dict' and 'dict'
```

<hr>


#### <a id='management-console-1-13-0-revise-dns-error'></a> TKGI MC Validation Error If the Deployment DNS IP Address Is Reconfigured after Installing TKGI in a BYOT Environment

This issue is fixed in [<%= vars.k8s_runtime_abbr %> MC v1.13.3](#management-console-1-13-3-features).  

**Symptom**

In an NSX-T Data Center - Bring Your Own Topology environment, <%= vars.k8s_runtime_abbr %> MC displays the following error 
if you reconfigure your TKGI deployment DNS after installing TKGI:  

```
Input validation failed Validation errors found: Fail to parse network : invalid CIDR address:
```

**Workaround**  

To reconfigure your TKGI Deployment DNS:

1. Open the <%= vars.k8s_runtime_abbr %> deployment YAML in the <%= vars.k8s_runtime_abbr %> MC YAML Editor.  
1. To modify the <%= vars.k8s_runtime_abbr %> Deployment DNS, modify the `dep_dns` field.  
1. To modify the <%= vars.k8s_runtime_abbr %> Deployment CIDR, modify the `dep_network_cidr` field. 
Provide any CIDR that does not contain the Deployment DNS IP.  
<br>
    For example:  

    ```
    network:
      dep_dns:192.168.111.155
      dep_network_cidr: "80.0.0.1/24"
    ```
    The new CIDR will not affect your original CIDR configuration.   

1. Click **Apply Configuration**.


<hr>
