---
title: Preparing to Deploy PKS on vSphere
owner: Ops Manager
---

<strong><%= modified_date %></strong>
<html class="list-style-none"></html>

Before you install Pivotal Container Service (PKS) on vSphere **without** NSX-T 
integration, you must prepare your vSphere environment. In addition to 
fulfilling the prerequisites specified in 
[vSphere Prerequisites and Resource Requirements](vsphere-requirements.html),
you must create the following two service accounts:

* **Master Node Service Account**: You must create a service account for 
Kubernetes cluster master VMs and grant it sufficient storage permissions to 
create load balancers and attach persistent disks to pods.

* **BOSH/Ops Manager Service Account**: You must create a service account for 
BOSH and Ops Manager.

<p class="note"><strong>Note</strong>: If your Kubernetes clusters span 
multiple vCenters, you must set the service account privileges correctly in 
each vCenter.</p>

vSphere Cloud Provider service accounts require the following:

* Read access to the folder, host, and datacenter of the cluster node VMs
* Permission to create and delete VMs within the resource pool where PKS is deployed

## <a id="create-master"></a>Step 1: Create the Master Node Service Account

1. From the vCenter console, create a service account for Kubernetes cluster master VMs.

1. Grant the following **Virtual Machine Object** permissions to the service account:
  <table>
    <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
      <tr><td>Advanced</td><td>VirtualMachine.Configuration.Advanced</td></tr>
      <tr><td>Settings</td><td>VirtualMachine.Configuration.Settings</td></tr>
  </table>

## <a id="addl-permissions"></a>Step 2: Grant Additional Storage Permissions

Grant additional permissions to the master node service account based on your storage configuration.

The tables in [Storage Permissions for Service Accounts](#storage-permissions) 
describe the following:

* [Static Only Persistent Volume Provisioning](#static-only)
* [Dynamic Persistent Volume Provisioning (with Storage Policy-Based Volume Placement)](#dynamic-policy)
* [Dynamic Persistent Volume Provisioning (without Storage Policy-Based Volume Placement)](#dynamic-no-policy)

See [vSphere Storage for Kubernetes](https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/index.html) 
in the VMware documentation for more information.

### <a id="storage-permissions"></a> Storage Permissions for Service Accounts

The following tables describe the minimum permissions required by the master 
node service account based on your storage configuration.

#### <a id="static-only"></a>Static Only Persistent Volume Provisioning
<table>
  <tr>
    <th>Roles</th>
    <th>Privileges</th>
    <th>Entities</th>
    <th>Propagate to Children</th>
  </tr>
  <tr>
    <td>manage-k8s-node-vms</td>
    <td>
      <ul>
        <li>VirtualMachine.Config.AddExistingDisk</li>
        <li>VirtualMachine.Config.AddNewDisk</li>
        <li>VirtualMachine.Config.AddRemoveDevice</li>
        <li>VirtualMachine.Config.RemoveDisk</li>
      </ul>
    </td>
    <td>VM Folder</td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>manage-k8s-volumes</td>
    <td>Datastore.FileManagement (Low level file operations)</td>
    <td>Datastore</td>
    <td>No</td>
  </tr>
  <tr>
    <td>Read-only (pre-existing default role)</td>
    <td>
      <ul>
        <li>System.Anonymous</li>
        <li>System.Read</li>
        <li>System.View</li>
      </ul>
    </td>
    <td>
      <ul>
        <li>vCenter</li>
        <li>Datacenter</li>
        <li>Datastore Cluster</li>
        <li>Datastore Storage Folder</li>
      </ul>
    </td>
    <td>No</td>
  </tr>
</table>

<p class="note"><strong>Note</strong>: Datastore.FileManagement is only 
required for the role <code>manage-k8s-volumes</code> if a Persistent Volume 
Claim (PVC) is created to bind with a statically provisioned Persistent Volume 
(PV), and the reclaim policy set to delete. When the PVC is deleted, the 
statically provisioned PV is also deleted.</p>

#### <a id="dynamic-policy"></a>Dynamic Persistent Volume Provisioning (with Storage Policy-Based Volume Placement)

<table>
  <tr>
    <th>Roles</th>
    <th>Privileges</th>
    <th>Entities</th>
    <th>Propagate to Children</th>
  </tr>
  <tr>
    <td>manage-k8s-node-vms</td>
    <td>
      <ul>
        <li>Resource.AssignVMToPool</li>
        <li>VirtualMachine.Config.AddExistingDisk</li>
        <li>VirtualMachine.Config.AddNewDisk</li>
        <li>VirtualMachine.Config.AddRemoveDevice</li>
        <li>VirtualMachine.Config.RemoveDisk</li>
        <li>VirtualMachine.Inventory.Create</li>
        <li>VirtualMachine.Inventory.Delete</li>
      </ul>
    </td>
    <td>
      <ul>
        <li>Cluster</li>
        <li>Hosts</li>
        <li>VM Folder</li>
      </ul>
    </td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>manage-k8s-volumes</td>
    <td>
      <ul>
        <li>Datastore.AllocateSpace</li>
        <li>Datastore.FileManagement (Low level file operations)</li>
      </ul>
    </td>
    <td>Datastore</td>
    <td>No</td>
  </tr>
  <tr>
    <td>k8s-system-read-and-spbm-profile-view</td>
    <td>StorageProfile.View (Profile-driven storage view)</td>
    <td>vCenter</td>
    <td>No</td>
  </tr>
  <tr>
    <td>Read-only (pre-existing default role)</td>
    <td>
      <ul>
        <li>System.Anonymous</li>
        <li>System.Read</li>
        <li>System.View</li>
      </ul>
    </td>
    <td>
      <ul>
        <li>Datacenter</li>
        <li>Datastore Cluster</li>
        <li>Datastore Storage Folder</li>
      </ul>
    </td>
    <td>No</td>
  </tr>
</table>


####<a id="dynamic-no-policy"></a>Dynamic Volume Provisioning (without Storage Policy-Based Volume Placement)

<table>
  <tr>
    <th>Roles</th>
    <th>Privileges</th>
    <th>Entities</th>
    <th>Propagate to Children</th>
  </tr>
  <tr>
    <td>manage-k8s-node-vms</td>
    <td>
      <ul>
        <li>VirtualMachine.Config.AddExistingDisk</li>
        <li>VirtualMachine.Config.AddNewDisk</li>
        <li>VirtualMachine.Config.AddRemoveDevice</li>
        <li>VirtualMachine.Config.RemoveDisk</li>
      </ul>
    </td>
    <td>VM Folder</td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>manage-k8s-volumes</td>
    <td>
      <ul>
        <li>Datastore.AllocateSpace</li>
        <li>Datastore.FileManagement (Low level file operations)</li>
      </ul>
    </td>
    <td>Datastore</td>
    <td>No</td>
  </tr>
  <tr>
    <td>Read-only (pre-existing default role)</td>
    <td>
      <ul>
        <li>System.Anonymous</li>
        <li>System.Read</li>
        <li>System.View</li>
      </ul>
    </td>
    <td>
      <ul>
        <li>vCenter</li>
        <li>Datacenter</li>
        <li>Datastore Cluster</li>
        <li>Datastore Storage Folder</li>
      </ul>
    </td>
    <td>No</td>
  </tr>
</table>

## <a id='create-bosh-ops-man'></a>Step 3: Create the BOSH/Ops Manager Service Account

1. From the vCenter console, create a service account for BOSH and Ops Manager.

2. Grant the permissions below to the BOSH and Ops Manager service account.

### <a id="root"></a>vCenter Root Privileges

Grant the following privileges on the root vCenter server entity to the service account:

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
    <tr><td>Read-only</td><td>System.Anonymous</td></tr>
    <tr><td></td><td>System.Read</td></tr>
    <tr><td></td><td>System.View</td></tr>
    <tr><td>Manage custom attributes</td><td>Global.ManageCustomFields</td></tr>
</table>

### <a id="datacenter"></a>vCenter Datacenter Privileges

Grant the following privileges on any entities in a datacenter where you deploy PKS:

#### <a id="role"></a>Role Object

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Users inherit the Read-Only role from the vCenter root level</td><td>System.Anonymous</td></tr>
  <tr><td></td><td>System.Read</td></tr>
  <tr><td></td><td>System.View</td></tr>
</table>

#### <a id="datastore"></a>Datastore Object

Grant the following privileges must at the datacenter level to upload and delete virtual machine files:

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Allocate space</td><td>Datastore.AllocateSpace</td></tr>
  <tr><td>Browse datastore</td><td>Datastore.Browse</td></tr>
  <tr><td>Low level file operations</td><td>Datastore.FileManagement</td></tr>
  <tr><td>Remove file</td><td>Datastore.DeleteFile</td></tr>
  <tr><td>Update virtual machine files</td><td>Datastore.UpdateVirtualMachineFiles</td></tr>
</table>

#### <a id="folder"></a>Folder Object

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Delete folder</td><td>Folder.Delete</td></tr>
  <tr><td>Create folder</td><td>Folder.Create</td></tr>
  <tr><td>Move folder</td><td>Folder.Move</td></tr>
  <tr><td>Rename folder</td><td>Folder.Rename</td></tr>
</table>

#### <a id="global"></a>Global Object

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Set custom attribute</td><td>Global.SetCustomField</td></tr>
</table>

##### <a id="host"></a>Host Object

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Modify cluster</td><td>Host.Inventory.EditCluster</td></tr>
</table>

#### <a id="inventory"></a> Inventory Service Object

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>vSphere Tagging > Create vSphere Tag</td><td>InventoryService.Tagging.CreateTag</td></tr>
  <tr><td>vSphere Tagging > Delete vSphere Tag</td><td>InventoryService.Tagging.EditTag</td></tr>
  <tr><td>vSphere Tagging > Edit vSphere Tag</td><td>InventoryService.Tagging.DeleteTag</td></tr>
</table>

#### <a id="network"></a>Network Object

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Assign network</td><td>Network.Assign</td></tr>
</table>

#### <a id="resource"></a>Resource Object

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Assign virtual machine to resource pool</td><td>Resource.AssignVMToPool</td></tr>
  <tr><td>Migrate powered off virtual machine</td><td>Resource.ColdMigrate</td></tr>
  <tr><td>Migrate powered on virtual machine</td><td>Resource.HotMigrate</td></tr>
</table>

#### <a id="vapp"></a>vApp Object

Grant these privileges at the resource pool level. 

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Import</td><td>VApp.Import</td></tr>
  <tr><td>vApp application configuration</td><td>VApp.ApplicationConfig</td></tr>
</table>

#### <a id="vm"></a>Virtual Machine Object

<a id='configuration'></a><strong>Configuration</strong>

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Add existing disk</td><td>VirtualMachine.Config.AddExistingDisk</td></tr>
  <tr><td>Add new disk</td><td>VirtualMachine.Config.AddNewDisk</td></tr>
  <tr><td>Add or remove device</td><td>VirtualMachine.Config.AddRemoveDevice</td></tr>
  <tr><td>Advanced</td><td>VirtualMachine.Config.AdvancedConfig</td></tr>
  <tr><td>Change CPU count</td><td>VirtualMachine.Config.CPUCount</td></tr>
  <tr><td>Change resource</td><td>VirtualMachine.Config.Resource</td></tr>
  <tr><td>Configure managedBy</td><td>VirtualMachine.Config.ManagedBy</td></tr>
  <tr><td>Disk change tracking</td><td>VirtualMachine.Config.ChangeTracking</td></tr>
  <tr><td>Disk lease</td><td>VirtualMachine.Config.DiskLease</td></tr>
  <tr><td>Display connection settings</td><td>VirtualMachine.Config.MksControl</td></tr>
  <tr><td>Extend virtual disk</td><td>VirtualMachine.Config.DiskExtend</td></tr>
  <tr><td>Memory</td><td>VirtualMachine.Config.Memory</td></tr>
  <tr><td>Modify device settings</td><td>VirtualMachine.Config.EditDevice</td></tr>
  <tr><td>Raw device</td><td>VirtualMachine.Config.RawDevice</td></tr>
  <tr><td>Reload from path</td><td>VirtualMachine.Config.ReloadFromPath</td></tr>
  <tr><td>Remove disk</td><td>VirtualMachine.Config.RemoveDisk</td></tr>
  <tr><td>Rename</td><td>VirtualMachine.Config.Rename</td></tr>
  <tr><td>Reset guest information</td><td>VirtualMachine.Config.ResetGuestInfo</td></tr>
  <tr><td>Set annotation</td><td>VirtualMachine.Config.Annotation</td></tr>
  <tr><td>Settings</td><td>VirtualMachine.Config.Settings</td></tr>
  <tr><td>Swapfile placement</td><td>VirtualMachine.Config.SwapPlacement</td></tr>
  <tr><td>Unlock virtual machine</td><td>VirtualMachine.Config.Unlock</td></tr>
</table>

<a id='guest-operations'></a><strong>Guest Operations</strong>

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Guest Operation Program Execution</td><td>VirtualMachine.GuestOperations.Execute</td></tr>
  <tr><td>Guest Operation Modifications</td><td>VirtualMachine.GuestOperations.Modify</td></tr>
  <tr><td>Guest Operation Queries</td><td>VirtualMachine.GuestOperations.Query</td></tr>
</table>

<a id='interaction'></a><strong>Interaction</strong>

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Answer question</td><td>VirtualMachine.Interact.AnswerQuestion</td></tr>
  <tr><td>Configure CD media</td><td>VirtualMachine.Interact.SetCDMedia</td></tr>
  <tr><td>Console interaction</td><td>VirtualMachine.Interact.ConsoleInteract</td></tr>
  <tr><td>Defragment all disks</td><td>VirtualMachine.Interact.DefragmentAllDisks</td></tr>
  <tr><td>Device connection</td><td>VirtualMachine.Interact.DeviceConnection</td></tr>
  <tr><td>Guest operating system management by VIX API</td><td>VirtualMachine.Interact.GuestControl</td></tr>
  <tr><td>Power off</td><td>VirtualMachine.Interact.PowerOff</td></tr>
  <tr><td>Power on</td><td>VirtualMachine.Interact.PowerOn</td></tr>
  <tr><td>Reset</td><td>VirtualMachine.Interact.Reset</td></tr>
  <tr><td>Suspend</td><td>VirtualMachine.Interact.Suspend</td></tr>
  <tr><td>VMware Tools install</td><td>VirtualMachine.Interact.ToolsInstall</td></tr>
</table>

<a id='inventory'></a><strong>Inventory</strong>

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Create from existing</td><td>VirtualMachine.Inventory.CreateFromExisting</td></tr>
  <tr><td>Create new</td><td>VirtualMachine.Inventory.Create</td></tr>
  <tr><td>Move</td><td>VirtualMachine.Inventory.Move</td></tr>
  <tr><td>Register</td><td>VirtualMachine.Inventory.Register</td></tr>
  <tr><td>Remove</td><td>VirtualMachine.Inventory.Delete</td></tr>
  <tr><td>Unregister</td><td>VirtualMachine.Inventory.Unregister</td></tr>
</table>

<a id="provisioning"></a><strong>Provisioning</strong>

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
  <tr><td>Allow disk access</td><td>VirtualMachine.Provisioning.DiskRandomAccess</td></tr>
  <tr><td>Allow read-only disk access</td><td>VirtualMachine.Provisioning.DiskRandomRead</td></tr>
  <tr><td>Allow virtual machine download</td><td>VirtualMachine.Provisioning.GetVmFiles</td></tr>
  <tr><td>Allow virtual machine files upload</td><td>VirtualMachine.Provisioning.PutVmFiles</td></tr>
  <tr><td>Clone template</td><td>VirtualMachine.Provisioning.CloneTemplate</td></tr>
  <tr><td>Clone virtual machine</td><td>VirtualMachine.Provisioning.Clone</td></tr>
  <tr><td>Customize</td><td>VirtualMachine.Provisioning.Customize</td></tr>
  <tr><td>Deploy template</td><td>VirtualMachine.Provisioning.DeployTemplate</td></tr>
  <tr><td>Mark as template</td><td>VirtualMachine.Provisioning.MarkAsTemplate</td></tr>
  <tr><td>Mark as virtual machine</td><td>VirtualMachine.Provisioning.MarkAsVM</td></tr>
  <tr><td>Modify customization specification</td><td>VirtualMachine.Provisioning.ModifyCustSpecs</td></tr>
  <tr><td>Promote disks</td><td>VirtualMachine.Provisioning.PromoteDisks</td></tr>
  <tr><td>Read customization specifications</td><td>VirtualMachine.Provisioning.ReadCustSpecs</td></tr>
</table>

<a id="snapshot"></a><strong>Snapshot Management</strong>

<table>
  <tr><th>Privilege (UI)</th><th>Privilege (API)</th></tr>
    <tr><td>Create snapshot</td><td>VirtualMachine.State.CreateSnapshot</td></tr>
    <tr><td>Remove snapshot</td><td>VirtualMachine.State.RemoveSnapshot</td></tr>
    <tr><td>Rename snapshot</td><td>VirtualMachine.State.RenameSnapshot</td></tr>
    <tr><td>Revert snapshot</td><td>VirtualMachine.State.RevertToSnapshot</td></tr>
</table>

## <a id="next-steps"></a>Next Steps

To install PKS on vSphere, follow the procedures in [Deploying Ops Manager to vSphere](vsphere-om-deploy.html).
